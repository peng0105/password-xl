const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DatabaseForOSS-TYSdYF0x.js","./ali-oss-CN0NZiD5.js","./vendor-BvEI7uIN.js","./@vue-PmY8Mkr0.js","./element-plus-DNQbW8zx.js","./@element-plus-CuK1irWX.js","./element-plus-DtJdknO8.css","./cos-js-sdk-v5-WX9VGj_f.js","./IndexPage-lJfzWKne.js","./local-DhpgDmJL.js","./logo-B_J9w6Yt.js","./IndexPage-C8yNMdJu.css","./LoginPage-DutXP21C.js","./LoginPage-Jf09kZPl.css","./NotePage-D1I74k-p.js","./aieditor-C5-FhIRr.js","./aieditor-C7A_tjCx.css","./NotePage-CFNlq5eI.css"])))=>i.map(i=>d[i]);
import{r as f,M as Me,d as Y,n as X,o as N,v as D,x as Be,c as U,D as b,a as F,B as R,u as g,j as Ue,S as re,H as Qe,z,P as et,aa as tt,F as Ge,I as st,ad as rt,ao as at}from"./@vue-PmY8Mkr0.js";import{E,a as Ke,b as G,c as Ae,d as Te,v as Je,e as Ee,f as Ne,g as ot,h as it,i as nt,z as lt,j as ut}from"./element-plus-DNQbW8zx.js";import{R as v,U as Z,V,W as ve,X as Ve,Z as ct,_ as dt,p as ft,$ as gt}from"./vendor-BvEI7uIN.js";import{C as ht}from"./cos-js-sdk-v5-WX9VGj_f.js";import"./@element-plus-CuK1irWX.js";import"./ali-oss-CN0NZiD5.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();var ae=(r=>(r.ASC="ascending",r.DESC="descending",r))(ae||{}),B=(r=>(r[r.NORMAL=0]="NORMAL",r[r.DELETED=1]="DELETED",r))(B||{}),O=(r=>(r.AUTO="auto",r.LIGHT="light",r.DARK="dark",r))(O||{}),je=(r=>(r[r.CARD=0]="CARD",r[r.TABLE=1]="TABLE",r))(je||{}),w=(r=>(r.NO_LOGIN="初始化",r.LOGGED="已登录",r.WAIT_INIT="待初始化",r.UNLOCKED="已解锁",r))(w||{}),j=(r=>(r.STANDARD="standard",r.GESTURE="gesture",r))(j||{});const H=()=>{let r="";try{r+=(Intl.DateTimeFormat().resolvedOptions().timeZone||"")+","}catch{}try{r+=(window.navigator.languages.join(",")||"")+",",r+=(window.navigator.hardwareConcurrency||"")+","}catch{}try{r+=(window.getComputedStyle(document.documentElement).fontFamily||"")+","}catch{}try{let e=document.createElement("canvas").getContext("webgl2");if(e){let t=e.getExtension("WEBGL_debug_renderer_info");t&&(r+=(e.getParameter(t.UNMASKED_RENDERER_WEBGL)||"")+",")}}catch{}return v.MD5(r).toString()},Ce=(r,e)=>{try{return!!x(r,e)}catch{return!1}};async function pt(r){const s=r.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s+/g,""),a=Uint8Array.from(atob(s),o=>o.charCodeAt(0));return crypto.subtle.importKey("spki",a.buffer,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"])}async function mt(r,e){const t=await pt(r),s=new TextEncoder().encode(e);let a=await crypto.subtle.encrypt({name:"RSA-OAEP"},t,s);function o(i){const n=new Uint8Array(i);let u="";for(let l=0;l<n.length;l++)u+=String.fromCharCode(n[l]);return btoa(u)}return o(a)}const P=(r,e)=>{const t=v.enc.Utf8.parse(e),s=v.enc.Utf8.parse(v.MD5(r).toString()),a=v.enc.Utf8.parse(v.MD5("password-xl").toString());return v.AES.encrypt(t,s,{iv:a,mode:v.mode.CBC,padding:v.pad.Pkcs7}).ciphertext.toString()},x=(r,e)=>{let t=v.enc.Hex.parse(e),s=v.enc.Base64.stringify(t);const a=v.enc.Utf8.parse(v.MD5(r).toString()),o=v.enc.Utf8.parse(v.MD5("password-xl").toString());return v.AES.decrypt(s,a,{iv:o,mode:v.mode.CBC,padding:v.pad.Pkcs7}).toString(v.enc.Utf8).toString()},De=r=>v.MD5(r).toString(),be=r=>{const e={},t=[];let s=0;for(let a=0;a<r.length;a++){const o=[];for(const i in r[a])e.hasOwnProperty(i)||(e[i]=s++),o[e[i]]=r[a][i];t.push(o)}return{keys:e,dataArray:t}},yt=r=>{const e=[];for(let t=0;t<r.dataArray.length;t++){const s=r.dataArray[t],a={};for(const o in r.keys){const i=s[r.keys[o]];i!==void 0&&(a[o]=i)}e.push(a)}return e},wt="modulepreload",St=function(r,e){return new URL(r,e).href},Ie={},se=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){let l=function(d){return Promise.all(d.map(m=>Promise.resolve(m).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const i=document.getElementsByTagName("link"),n=document.querySelector("meta[property=csp-nonce]"),u=n?.nonce||n?.getAttribute("nonce");a=l(t.map(d=>{if(d=St(d,s),d in Ie)return;Ie[d]=!0;const m=d.endsWith(".css"),h=m?'[rel="stylesheet"]':"";if(s)for(let A=i.length-1;A>=0;A--){const k=i[A];if(k.href===d&&(!m||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${h}`))return;const p=document.createElement("link");if(p.rel=m?"stylesheet":wt,m||(p.as="script"),p.crossOrigin="",p.href=d,u&&p.setAttribute("nonce",u),document.head.appendChild(p),m)return new Promise((A,k)=>{p.addEventListener("load",A),p.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(i){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=i,window.dispatchEvent(n),!n.defaultPrevented)throw i}return a.then(i=>{for(const n of i||[])n.status==="rejected"&&o(n.reason);return e().catch(o)})};class vt{fileNames={store:"password-xl/store.json",setting:"password-xl/setting.json",note:"password-xl/note.json"};fileEtags={};cosClient=null;region="";bucket="";async login(e){return this.cosClient=new ht({SecretId:e.secretId,SecretKey:e.secretKey}),this.region=e.region,this.bucket=e.bucket,Promise.resolve({status:!0})}async getStoreData(){return this.getFile(this.fileNames.store)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){return new Promise((s,a)=>{if(!this.cosClient)throw new Error("cos getFile 存储引擎不存在");let o=e.name.split(".").pop(),i="/images/"+t+"/"+kt()+"."+o;this.cosClient.putObject({Bucket:this.bucket,Region:this.region,Key:i,Body:e},(n,u)=>{n?(E.error({title:"系统异常",message:this.errorDispose(n)}),a({status:!1,message:this.errorDispose(n)})):s("https://"+this.bucket+".cos."+this.region+".myqcloud.com"+i)})})}async getFile(e){return new Promise((t,s)=>{if(!this.cosClient)throw new Error("cos getFile 存储引擎不存在");this.cosClient.getObject({Bucket:this.bucket,Region:this.region,Key:e},(a,o)=>{if(o){this.updateEtag(e,o.ETag),t(JSON.parse(o.Body.toString()));return}a&&a.statusCode===404?t(""):(E.error({title:"系统异常",message:this.errorDispose(a)}),s({status:!1,message:this.errorDispose(a)}))})})}async uploadFile(e,t){return new Promise(async(s,a)=>{if(!this.cosClient)throw new Error("cos uploadFile 存储引擎不存在");if(!await this.checkEtag(e)){Ke({title:"文件同步异常",message:"当前密码列表已被其他客户端更新，请刷新页面",showCancelButton:!1,showConfirmButton:!0,closeOnPressEscape:!1,showClose:!1,closeOnClickModal:!1,confirmButtonText:"刷新",callback:()=>{location.reload()}});return}this.cosClient.putObject({Bucket:this.bucket,Region:this.region,Key:e,Body:JSON.stringify(t)},(i,n)=>{i?(E.error({title:"系统异常",message:this.errorDispose(i)}),a({status:!1,message:this.errorDispose(i)})):(this.updateEtag(e,n.ETag),s({status:!0}))})})}async deleteFile(e){return new Promise((t,s)=>{if(!this.cosClient)throw new Error("cos deleteFile 存储引擎不存在");this.cosClient.deleteObject({Bucket:this.bucket,Region:this.region,Key:e},a=>{a?(E.error({title:"系统异常",message:this.errorDispose(a)}),s({status:!1,message:this.errorDispose(a)})):t({status:!0})})})}errorDispose(e){let t={"CORS blocked or network error":"有可能是存储桶（bucket）不存在、地域（region）错误、跨域配置错误","Access Denied.":"该账号无存储桶（bucket）权限或存储桶错误",'Bucket should format as "test-1250000000".':"存储桶（bucket）格式错误"};if(e){if(e.code==="InvalidAccessKeyId")return"账户（secretId）无效";if(e.code==="SignatureDoesNotMatch")return"密钥（secretKey）无效";if(e.code==="Error"){let s=t[e.message];return s||e.message}}return"COS登录异常-未知原因"}getEtag(e){return new Promise(async t=>{if(!this.cosClient)throw new Error("cos getEtag 存储引擎不存在");this.cosClient.headObject({Bucket:this.bucket,Region:this.region,Key:e},function(s,a){t(a.ETag)})})}async checkEtag(e){if(!this.fileEtags[e])return Promise.resolve(!0);let t=await this.getEtag(e);return this.fileEtags[e]===t}async updateEtag(e,t){this.fileEtags[e]=t}}const K=Z("settingStore",{state:()=>({visSetting:!1,setting:{autoGeneratePassword:!0,customFields:[],easyConfuseChat:"0OoIil",showLabelCard:!0,enableAiAdd:!0,showFavoriteCard:!0,enableRecycleBin:!1,enableShortcutKey:!0,generateRule:{length:16,lowercase:!0,number:!0,symbol:!0,uppercase:!0},showTimeForTable:"no",showLabelForTable:!0,showStrength:!0,sortOrder:ae.DESC,sortField:"addTime",timeoutLock:0,verifyShowGesture:!0,passwordDisplayMode:je.CARD,autoLogin:!0,autoUnlock:!1,showPasswordStatistics:!1,showNote:!1,bgColors:["rgb(255,0,0)","rgb(255,136,0)","rgb(115,255,0)","rgb(0,208,255)","rgb(95,0,255)","rgb(178,0,255)","rgb(0,0,0)"],dynamicBackground:!0,passwordColor:!1}})}),q=Z("refStore",{state:()=>({verifyPasswordRef:f(),passwordFormRef:f(),cancelAccountRef:f(),settingRef:f(),labelTreeRef:f(),labelTreeDivRef:f(),setPasswordRef:f(),recycleBinRef:f(),backupAndRecoveryRef:f(),fastLoginRef:f(),aiAddPasswordRef:f(),labelDrawer:f(),favoriteDrawer:f(),tourRef:f(),showPasswordRef:f(),exportExcelRef:f(),importExcelRef:f(),contextmenuRef:f(),createPasswordBtnRef:f(),aiCreatePasswordBtnRef:f(),passwordFormFormRef:f(),passwordFormTitleRef:f(),passwordFormGenerateBtnRef:f(),passwordFormGenerateRuleRef:f(),passwordFormSaveBtnRef:f(),displayModeCardRef:f(),displayModeTableRef:f(),searchInputRef:f(),noteTitleRef:f(),aiImportRef:f()})});class Dt{fileNames={store:"store.json",setting:"setting.json",note:"note.json"};fileEtags={};serverUrl="";token="";async login(e){return this.serverUrl=e.serverUrl,new Promise(t=>{V.post(this.serverUrl+"/login",{username:e.username,password:e.password}).then(s=>{if(s.status!==200){t({status:!1,message:s.statusText});return}if(s.data.code!==200){t({status:!1,message:s.data.message});return}this.token=s.data.data,t({status:!0})}).catch(s=>{t({status:!1,message:this.errorDispose(s.message)})})})}async getStoreData(){return this.getFile(this.fileNames.store)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){return new Promise((s,a)=>{const o=new FormData;o.append("file",e),V.post(this.serverUrl+"/uploadImage/"+t,o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.token}`}}).then(i=>{s(this.serverUrl+"/image"+i.data.data.objectKey)}).catch(i=>{a(i)})})}async getFile(e){return new Promise((t,s)=>{V.post(this.serverUrl+"/get",{key:e},{headers:{Authorization:`Bearer ${this.token}`}}).then(a=>{if(a.data.code===500){E.error({title:"系统异常",message:this.errorDispose(a.data.message)}),s({status:!1,message:a.data.message});return}if(a.data.code===404){t("");return}if(a.status===200){this.updateEtag(e,a.data.data.etag),t(a.data.data.content);return}s({status:!1,message:a.statusText})}).catch(a=>{E.error({title:"系统异常",message:a.message}),s({status:!1,message:a})})})}async uploadFile(e,t){return new Promise(async(s,a)=>{if(!await this.checkEtag(e)){Ke({title:"文件同步异常",message:"当前密码列表已被其他客户端更新，请刷新页面",showCancelButton:!1,showConfirmButton:!0,closeOnPressEscape:!1,showClose:!1,closeOnClickModal:!1,confirmButtonText:"刷新",callback:()=>{location.reload()}});return}V.post(this.serverUrl+"/put",{key:e,content:t},{headers:{Authorization:`Bearer ${this.token}`}}).then(i=>{if(i.data.code===500){E.error({title:"系统异常",message:this.errorDispose(i.data.message)}),a({status:!1,message:i.data.message});return}if(i.status===200){this.updateEtag(e,i.data.data.etag),s({status:!0});return}a({status:!1,message:i.statusText})}).catch(i=>{E.error({title:"系统异常",message:i.message}),a({status:!1,message:i})})})}async deleteFile(e){return new Promise((t,s)=>{V.post(this.serverUrl+"/delete",{key:e},{headers:{Authorization:`Bearer ${this.token}`}}).then(a=>{if(a.data.code===500){E.error({title:"系统异常",message:this.errorDispose(a.data.message)}),s({status:!1,message:a.data.message});return}if(a.status===200){t({status:!0});return}s({status:!1,message:a.statusText})}).catch(a=>{s({status:!1,message:a})})})}errorDispose(e){return e.indexOf("Invalid URL")!==-1?"无效的服务地址":{"IORuntimeException: IOException: Permission denied":"服务端文件权限不足","Network Error":"无法连接到服务器"}[e]||e}getEtag(e){return new Promise(async(t,s)=>{V.post(this.serverUrl+"/getEtag",{key:e},{headers:{Authorization:`Bearer ${this.token}`}}).then(a=>{if(a.data.code===500){E.error({title:"系统异常",message:this.errorDispose(a.data.message)}),s({status:!1,message:a.data.message});return}if(a.status===200){t(a.data.data.etag);return}s({status:!1,message:a.statusText})}).catch(a=>{E.error({title:"系统异常",message:a.message}),s({status:!1,message:a})})})}async checkEtag(e){if(!this.fileEtags[e])return Promise.resolve(!0);let t=await this.getEtag(e);return this.fileEtags[e]===t}async updateEtag(e,t){this.fileEtags[e]=t}}class bt{fileNames={store:"store.json",setting:"setting.json",note:"password-xl/note.json"};async login(e){return Promise.resolve({status:!0})}async getStoreData(){return this.getFile(this.fileNames.store)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){return new Promise(async s=>{const a=await e.arrayBuffer();let o=await window.electronAPI.uploadImage(e.name,a,t);s(o)})}async getFile(e){return new Promise(async t=>{let s=await window.electronAPI.getFile(e);t(s||"")})}async uploadFile(e,t){return new Promise(async s=>{window.electronAPI.uploadFile(e,t),s({status:!0})})}async deleteFile(e){return new Promise(t=>{window.electronAPI.deleteFile(e),t({status:!0})})}}class Ct{fileNames={store:"store.json",setting:"setting.json",note:"note.json"};async login(e){return Promise.resolve({status:!0})}async getStoreData(){return this.getFile(this.fileNames.store)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){throw new Error("安卓本地存储暂不支持上传图片，请改用其他存储方式")}async getFile(e){return new Promise(async t=>{let s=await window.androidAPI.getFile(e);t(s||"")})}async uploadFile(e,t){return new Promise(async s=>{window.androidAPI.uploadFile(e,t),s({status:!0})})}async deleteFile(e){return new Promise(t=>{window.androidAPI.deleteFile(e),t({status:!0})})}}const oe=Z("loginStore",{state:()=>({loginType:"",logging:!1,loggingText:"正在登录...",loginForm:null}),actions:{startLogin:async function(r,e){return new Promise(async t=>{let s=null;if(r.loginType==="oss"){const n=await se(()=>import("./DatabaseForOSS-TYSdYF0x.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url);s=new n.DatabaseForOSS}else if(r.loginType==="cos")s=new vt;else if(r.loginType==="private")s=new Dt;else if(r.loginType==="electron")s=new bt;else if(r.loginType==="android")s=new Ct;else{t(!1);return}this.loginType=r.loginType;let a=L();if(a.loading("自动登录中..."),!(await s.login(r)).status){a.unloading(),t(!1);return}let i=await a.passwordManager.login(s).catch(()=>t(!1));if(!i||!i.status){a.unloading(),t(!1);return}if(a.serviceStatus===w.LOGGED){let n=a.passwordManager.unlock(e);a.unloading(),t(n)}else a.serviceStatus===w.WAIT_INIT&&(a.unloading(),t(!0));this.loginForm=r})},autoLogin(){return new Promise(async r=>{try{let e=localStorage.getItem("loginInfo");if(!e){r(!1);return}let t=x(H(),e);if(!t){r(!1);return}let s=JSON.parse(t),a=await this.getMainPassword(s),o=JSON.parse(x(a,s.loginForm)),i=await this.startLogin(o,a);r(i)}catch{r(!1)}})},async getMainPassword(r){let e=localStorage.getItem("mainPassword");if(e){let t=x(H(),e);if(Ce(t,r.loginForm))return t}return await q().verifyPasswordRef.getAndVerify(t=>Ce(t,r.loginForm),r.mainPasswordType)},setAutoLoginInfo(r){const e=K();let t=sessionStorage.getItem("loginForm");if(e.setting.autoLogin&&t){let s=x(H(),t),a={mainPasswordType:L().mainPasswordType,loginForm:P(r,s)};localStorage.setItem("loginInfo",P(H(),JSON.stringify(a))),sessionStorage.removeItem("loginForm")}if(e.setting.autoUnlock){let s=H();localStorage.setItem("mainPassword",P(s,r))}},updateRememberLoginInfo(r,e){try{let t=localStorage.getItem("loginInfo");if(!t)return!1;let s=H(),a=x(s,t);if(!a)return!1;let o=JSON.parse(a),i=L().mainPasswordType;return o.mainPasswordType=i,o.loginForm=P(e,x(r,o.loginForm)),localStorage.setItem("loginInfo",P(s,JSON.stringify(o))),!0}catch{return!1}}}}),Pt=Z("noteStore",{state:()=>({noteData:{noteTree:[],currentNote:""}}),actions:{getTreeNoteById(r,e=this.noteData.noteTree){for(const t of e){if(t.id===r)return t;if(t.children){const s=this.getTreeNoteById(r,t.children);if(s)return s}}return null}}});class Fe{storeData=null;treeNoteData=null;databaseClient=null;passwordStore=L();loginStore=oe();settingStore=K();noteStore=Pt();refStore=q();nodeCacheMap=new Map;async login(e){return new Promise(async(t,s)=>{try{const[a,o,i]=await Promise.all([e.getStoreData(),e.getSettingData(),e.getTreeNoteData()]);a&&(this.storeData=JSON.parse(a),this.storeData&&this.storeData.mainPasswordType&&(this.passwordStore.mainPasswordType=this.storeData.mainPasswordType)),o&&Object.assign(this.settingStore.setting,JSON.parse(o)),i&&(this.treeNoteData=JSON.parse(i)),this.databaseClient=e,this.passwordStore.passwordManager=this,this.storeData&&this.storeData.passwordData?(this.passwordStore.mainPasswordType=this.storeData.mainPasswordType,this.passwordStore.setServiceStatus(w.LOGGED)):this.passwordStore.setServiceStatus(w.WAIT_INIT),t({status:!0})}catch(a){s({status:!1,message:a})}})}async initMainPassword(e,t){if(this.serviceStatusAssert(w.WAIT_INIT),this.passwordStore.mainPassword)throw new Error("密码已存在，不允许初始化");if(!this.databaseClient)throw new Error("系统异常");try{this.passwordStore.mainPassword=t,this.storeData={passwordData:P(t,JSON.stringify(be([]))),labelData:P(t,JSON.stringify([])),mainPasswordType:e};let s=await this.databaseClient.setStoreData(JSON.stringify(this.storeData));return!s||!s.status?Promise.reject(s):await this.syncSetting()?(this.passwordStore.mainPasswordType=e,this.passwordStore.setServiceStatus(w.UNLOCKED),this.addDemoData(),await this.syncStoreData(),Me(()=>{this.refStore.tourRef?.startTour()}),Promise.resolve({status:!0})):Promise.reject({status:!1,message:"设置同步失败"})}catch(s){return Promise.reject(s)}}addDemoData(){let e={id:Date.now(),pid:0,name:"网站",children:[]},t={id:Date.now(),title:"百度（示例数据）",address:"https://www.baidu.com",username:"18395708888",password:ze(this.settingStore.setting.generateRule),remark:"百度网盘、百度贴吧",addTime:Date.now(),updateTime:Date.now(),deleteTime:0,favoriteTime:0,favorite:!0,customFields:[],labels:[e.id],status:B.NORMAL,bgColor:""};this.passwordStore.labelArray.push(e),this.passwordStore.allPasswordArray.push(t)}verifyPassword(e,t){try{return t?!!x(e,t):this.storeData?!!x(e,this.storeData.passwordData):!1}catch{return!1}}async updateMainPassword(e,t,s){if(!this.databaseClient)return Promise.reject();if(this.serviceStatusAssert(w.UNLOCKED),!this.verifyPassword(e))return Promise.reject({status:!1,message:"旧密码错误"});this.passwordStore.loading("密码修改中...");let o=JSON.stringify(this.storeData),i=JSON.stringify(this.treeNoteData);this.storeData={passwordData:P(s,JSON.stringify(be(this.passwordStore.allPasswordArray))),labelData:P(s,JSON.stringify(this.passwordStore.labelArray)),mainPasswordType:t},this.treeNoteData={noteData:P(s,JSON.stringify(this.noteStore.noteData)),mainPasswordType:t};let n=await this.databaseClient.setStoreData(JSON.stringify(this.storeData)),u=await this.databaseClient.setNoteData(JSON.stringify(this.treeNoteData));return!n||!n.status||!u||!u.status?(this.storeData=JSON.parse(o),this.treeNoteData=JSON.parse(i),E.error({title:"系统异常",message:n.message}),Promise.reject()):(this.passwordStore.mainPasswordType=t,this.passwordStore.mainPassword=s,this.loginStore.updateRememberLoginInfo(e,s),this.passwordStore.unloading(),Promise.resolve({status:!0}))}addPassword(e){this.serviceStatusAssert(w.UNLOCKED);const t={...e,id:Date.now(),addTime:Date.now(),updateTime:Date.now(),status:B.NORMAL};return this.passwordStore.allPasswordArray.unshift(t),this.syncStoreData()}updatePassword(e){this.serviceStatusAssert(w.UNLOCKED);const t=this.passwordStore.allPasswordArray.findIndex(s=>s.id===e.id);return t!==-1?(this.passwordStore.allPasswordArray[t]=e,this.syncStoreData()):Promise.reject("没有找到这个密码："+e.id)}deletePassword(e){if(this.serviceStatusAssert(w.UNLOCKED),this.settingStore.setting.enableRecycleBin){const s=this.passwordStore.allPasswordArray.findIndex(a=>a.id===e);if(s!==-1){if(this.passwordStore.allPasswordArray[s].status===B.DELETED)return this.completelyDeletePassword(e);{let o=this.passwordStore.allPasswordArray[s];return o.deleteTime=Date.now(),o.status=B.DELETED,this.syncStoreData()}}else throw new Error("密码不存在")}else return this.completelyDeletePassword(e)}completelyDeletePassword(e){this.serviceStatusAssert(w.UNLOCKED);const t=this.passwordStore.allPasswordArray.findIndex(s=>s.id===e);if(t!==-1)return this.passwordStore.allPasswordArray.splice(t,1),this.syncStoreData();throw new Error("未找到指定ID的密码")}cancelDeletePassword(e){this.serviceStatusAssert(w.UNLOCKED);const t=this.passwordStore.allPasswordArray.findIndex(s=>s.id===e);if(t!==-1){let s=this.passwordStore.allPasswordArray[t];return s.deleteTime=0,s.status=B.NORMAL,this.syncStoreData()}else throw new Error("未找到指定ID的密码")}unlock(e){if(this.serviceStatusAssert(w.LOGGED),!this.storeData)throw new Error("系统异常");try{if(!Ce(e,this.storeData.passwordData))return G.error("解锁失败-密码错误"),!1;let t=x(e,this.storeData.passwordData),s=x(e,this.storeData.labelData);if(!t||!s)return G.error("解锁失败-密码错误"),!1;if(this.treeNoteData&&this.treeNoteData.noteData){let a=x(e,this.treeNoteData.noteData);a&&(this.noteStore.noteData=JSON.parse(a))}return this.passwordStore.allPasswordArray=yt(JSON.parse(t)),this.passwordStore.labelArray=JSON.parse(s),this.passwordStore.mainPassword=e,this.passwordStore.setServiceStatus(w.UNLOCKED),this.loginStore.setAutoLoginInfo(e),!0}catch{return!1}}lock(){this.passwordStore.mainPassword="",this.passwordStore.allPasswordArray=[],this.passwordStore.labelArray=[],this.passwordStore.setServiceStatus(w.LOGGED),localStorage.removeItem("mainPassword")}emptyRecycle(){return this.passwordStore.allPasswordArray=this.passwordStore.allPasswordArray.filter(e=>e.status!==B.DELETED),this.syncStoreData()}syncSetting(){if([w.NO_LOGIN].includes(this.passwordStore.serviceStatus))throw new Error("当前状态不允许该操作："+this.passwordStore.serviceStatus);if(!this.databaseClient)throw new Error("系统异常databaseClient isnull syncLabelData");return this.databaseClient.setSettingData(JSON.stringify(this.settingStore.setting))}syncStoreData(){if(this.serviceStatusAssert(w.UNLOCKED),this.storeData={passwordData:P(this.passwordStore.mainPassword,JSON.stringify(be(this.passwordStore.allPasswordArray))),labelData:P(this.passwordStore.mainPassword,JSON.stringify(this.passwordStore.labelArray)),mainPasswordType:this.passwordStore.mainPasswordType},!this.databaseClient)throw new Error("系统异常databaseClient isnull syncLabelData");return this.databaseClient.setStoreData(JSON.stringify(this.storeData))}syncNoteData(){if(this.serviceStatusAssert(w.UNLOCKED),!this.databaseClient)throw new Error("系统异常databaseClient isnull syncNoteData");let e={noteData:P(this.passwordStore.mainPassword,JSON.stringify(this.noteStore.noteData)),mainPasswordType:this.passwordStore.mainPasswordType};return this.databaseClient.setNoteData(JSON.stringify(e))}getStoreData(){if(this.storeData)return this.storeData;throw new Error("文件不存在")}getTreeNoteData(){if(this.treeNoteData)return this.treeNoteData;throw new Error("文件不存在")}async closeAccount(){return new Promise(async e=>{if(this.serviceStatusAssert(w.UNLOCKED),!this.databaseClient)throw new Error("系统异常databaseClient isnull closeAccount");let t=await this.databaseClient.deleteStoreData().catch(s=>s);await this.databaseClient.deleteSettingData().catch(s=>s),e(t)})}serviceStatusAssert=e=>{if(this.passwordStore.serviceStatus!==e)throw new Error("当前服务状态不允许该操作："+this.passwordStore.serviceStatus)};getData=e=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull getData");let t=this.nodeCacheMap.get(e);return t?Promise.resolve(t):new Promise(s=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull getData");this.databaseClient.getData(e).then(a=>{this.nodeCacheMap.set(e,a),s(a)})})};setData=(e,t)=>new Promise(s=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull setData");this.databaseClient.setData(e,t).then(a=>{this.nodeCacheMap.set(e,t),s(a)})});delData=e=>new Promise(t=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull setData");this.databaseClient.deleteData(e).then(s=>{t(s)})});uploadImage=(e,t)=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull setData");return this.databaseClient.uploadImage(e,t)}}const L=Z("passwordStore",{state:()=>({passwordManager:new Fe,allPasswordArray:[],labelArray:[],mainPassword:"",serviceStatus:w.NO_LOGIN,topicMode:O.AUTO,mainPasswordType:j.GESTURE,passwordFormDrawerVis:!1,recycleBinDialogVis:!1,timeoutLock:null,globalLoading:{vis:!1,timeout:null,content:""},filterCondition:{searchText:"",labelArray:[],favoriteId:0}}),getters:{passwordArray(){const r=K();return this.allPasswordArray.filter(t=>t.status===B.NORMAL).sort((t,s)=>{let a=t[r.setting.sortField],o=s[r.setting.sortField];return r.setting.sortField==="strength"&&(a=ie(t.password),o=ie(s.password)),a>o?r.setting.sortOrder===ae.ASC?1:-1:a<o?r.setting.sortOrder===ae.ASC?-1:1:0})},deletedArray(){return this.allPasswordArray.filter(e=>e.status===B.DELETED).sort((e,t)=>e.deleteTime>t.deleteTime?1:e.deleteTime<t.deleteTime?-1:0)},favoritePasswordArray(){return this.passwordArray.filter(e=>e.favorite).sort((e,t)=>e.favoriteTime>t.favoriteTime?1:e.favoriteTime<t.favoriteTime?-1:0)},visPasswordArray(){return this.passwordArray.filter(e=>{if(this.filterCondition.favoriteId)return e.id===this.filterCondition.favoriteId;let t=!0,s=!0;if(this.filterCondition.searchText){t=!1;const a=[e.title,e.address,e.username,e.password,e.remark].filter(Boolean);if(e.customFields)for(let o=0;o<e.customFields.length;o++)a.push(e.customFields[o].key),a.push(e.customFields[o].val);for(const o of a)if(Tt(this.filterCondition.searchText.trim(),o)){t=!0;break}}if(this.filterCondition.labelArray.length){s=!1;const a=new Set(e.labels);for(const o of this.filterCondition.labelArray)if(a.has(o)){s=!0;break}}return t&&s})},isDark(){return this.topicMode===O.DARK}},actions:{setServiceStatus(r){this.serviceStatus=r},logout(){sessionStorage.removeItem("loginForm"),localStorage.removeItem("loginInfo"),localStorage.removeItem("mainPassword"),localStorage.removeItem("topicMode"),this.passwordManager=new Fe,this.allPasswordArray=[],this.labelArray=[],this.mainPassword="",this.serviceStatus=w.NO_LOGIN,L().$resetFields(),oe().$resetFields(),K().$resetFields(),location.href=xe()+"#/login"},setTopicMode(r){if(localStorage.setItem("topicMode",r),r===O.AUTO){let e=window.matchMedia("(prefers-color-scheme: dark)");ve().value=e.matches,this.topicMode=e.matches?O.DARK:O.LIGHT,window.electronAPI?.setTopic&&window.electronAPI?.setTopic("system"),window.androidAPI?.setTopic&&window.androidAPI?.setTopic("system")}else r===O.DARK?(ve().value=!0,this.topicMode=O.DARK,window.electronAPI?.setTopic&&window.electronAPI?.setTopic(this.topicMode),window.androidAPI?.setTopic&&window.androidAPI?.setTopic(this.topicMode)):r===O.LIGHT&&(ve().value=!1,this.topicMode=O.LIGHT,window.electronAPI?.setTopic&&window.electronAPI?.setTopic(this.topicMode),window.androidAPI?.setTopic&&window.androidAPI?.setTopic(this.topicMode))},loading(r){this.globalLoading.timeout=setTimeout(()=>{this.globalLoading.timeout=null,this.globalLoading.vis=!0,this.globalLoading.content=r||"请稍等"},300)},unloading(){this.globalLoading.timeout&&(clearTimeout(this.globalLoading.timeout),this.globalLoading.timeout=null),this.globalLoading.vis=!1},resetTimeoutLock(){this.timeoutLock&&(clearTimeout(this.timeoutLock),this.timeoutLock=null);const r=K();r.setting.timeoutLock!==0&&(this.timeoutLock=setTimeout(()=>{if(r.setting.timeoutLock&&this.serviceStatus===w.UNLOCKED&&!r.setting.autoUnlock){this.passwordManager.lock();let e=q();e.settingRef?.closeSetting(),e.passwordFormRef?.closePasswordForm()}},r.setting.timeoutLock*1e3))}}}),us=r=>r&&/^.*:\/\/.*$/.test(r),W=f(""),ne=()=>{let r=window.innerWidth;return r<768?W.value="xs":r>=768&&r<992?W.value="sm":r>=992&&r<1200?W.value="md":r>=1200&&r<1920?W.value="lg":W.value="xl",W};window.onresize=()=>{ne()};async function At(r,e=!1){let t=document.createElement("textarea");t.setAttribute("readonly","readonly"),t.value=r,document.body.appendChild(t),t.setSelectionRange(0,t.value.length),t.select(),document.execCommand("copy"),document.body.removeChild(t),e||G.success("复制成功")}const Tt=(r,e)=>{if(!e||!r)return!1;try{const t=r.toLowerCase();if(e.toLowerCase().includes(t))return!0}catch{}return!1},ie=r=>{if(!r)return 0;let e=0;return/[0-9]/.test(r)&&e++,/[a-z]/.test(r)&&e++,/[A-Z]/.test(r)&&e++,/[^0-9a-zA-Z_]/.test(r)&&e++,r.length<6&&e>2&&(e=2),e>3?3:e},te={uppercase:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",lowercase:"abcdefghijklmnopqrstuvwxyz",number:"0123456789",symbol:"~!@#$%^&*()_-+=.,;"};function ze(r){let e=[r.uppercase?te.uppercase:"",r.lowercase?te.lowercase:"",r.number?te.number:"",r.symbol?te.symbol:""].filter(Boolean);const t=K();if(t.setting.easyConfuseChat){const a=t.setting.easyConfuseChat.split("");for(let o=0;o<e.length;o++)for(let i=0;i<a.length;i++)e[o]=e[o].replace(a[i],"")}if(e=e.filter(Boolean),!e.length)return E.error({title:"生成失败",message:"请检查易混淆字符配置"}),"";let s="";for(let a=0;a<r.length;a++){const o=e[a%e.length],i=Math.floor(Math.random()*o.length);s+=o[i]}return s.split("").sort(()=>Math.random()-.5).join("")}const cs=(r,e)=>{if(!r.labels)return[];const t=(a,o)=>{for(let i=0;i<a.length;i++)r.labels.includes(a[i].id)&&o.push(a[i]),a[i].children.length&&t(a[i].children,o)},s=[];return t(e||L().labelArray,s),s},ds=r=>{let e=r.title+`\r
`;if(r.address&&(e+="地址: "+r.address+`\r
`),r.username&&(e+="用户名: "+r.username+`\r
`),r.password&&(e+="密码: "+r.password+`\r
`),r.customFields)for(let t=0;t<r.customFields.length;t++){let s=r.customFields[t];e+=s.key+": "+s.val+`\r
`}r.remark&&(e+=r.remark+`\r
`),e=e.substring(0,e.length-2),At(e,!0),G.success("已复制到剪切板")},fs=r=>{let e=ie(r);return["","#F56C6C","#FF9700","#67C23A"][e]},gs=r=>{let e=ie(r);return["","弱密码","中等强度密码","强密码"][e]},Et=(r,e)=>{const t=new Date(r),s=d=>d<10?"0"+d:d,a=t.getFullYear(),o=s(t.getMonth()+1),i=s(t.getDate()),n=s(t.getHours()),u=s(t.getMinutes()),l=s(t.getSeconds());return e.replace("YYYY",a.toString()).replace("MM",o.toString()).replace("DD",i.toString()).replace("HH",n.toString()).replace("mm",u.toString()).replace("ss",l.toString())},hs=(r,e)=>{const t=e.split(/[^A-Za-z]/),s=r.split(/[^0-9]/),a={};t.forEach((m,h)=>{a[m]=parseInt(s[h],10)});const o=a.YYYY||1970,i=(a.MM||1)-1,n=a.DD||1,u=a.HH||0,l=a.mm||0,d=a.ss||0;return new Date(o,i,n,u,l,d)},ps=(r,e)=>{let t=Date.now();e.forEach(s=>{let a=r.findIndex(i=>i.id===s.id);if(a===-1){r.push(s);return}let o=r[a];if(xt(s,o)){if(s.labels&&s.labels.length>0){const i=new Set(o.labels);o.labels=s.labels.filter(n=>!i.has(n))}return}s.remark+="（合并恢复 "+Et(Date.now(),"YYYY-MM-DD HH:mm")+"）",s.id=t++,r.push(s)})},ms=(r,e)=>{let t=Date.now();const s=(i,n)=>{for(const u of i){if(u.id===n)return!0;if(u.children&&u.children.length>0)return s(u.children,n)}return!1},a=(i,n)=>{for(const u of i)if(u.id===n.id&&u.name===n.name&&u.pid===n.pid)return u},o=(i,n)=>{const u=a(i,n);if(!u)s(r,n.id)&&(n.id=t++),i.push(n);else for(const l of n.children)o(u.children,l)};for(const i of e)o(r,i)},ys=()=>{let r=0;const e=t=>{t.forEach(s=>{r++,s.children&&s.children.length>0&&e(s.children)})};return e(L().labelArray),r},ws=r=>{let e="";const t=(s,a)=>{s.forEach(o=>{r.includes(o.id)&&(e&&(e+="、"),e+=a+"->"+o.name),o.children&&o.children.length>0&&t(o.children,o.name)})};return t(L().labelArray,""),e},Ss=r=>{const e=r.split("、"),t=[];return e.forEach(s=>{const a=s.split("->").map(i=>i.trim());let o;a.forEach((i,n)=>{let u;n===0?(u=t.find(l=>l.name===i&&l.pid===0),!u&&i&&(u={id:Oe(),name:i,pid:0,children:[]},t.push(u))):(u=o?.children.find(l=>l.name===i),u||(u={id:Oe(),name:i,pid:o?o.id:0,children:[]},o?.children.push(u))),o=u})}),t},Nt=(r,e,t,s,a)=>Math.sqrt((s-r)*(s-r)+(a-e)*(a-e))<=t,Re=r=>r.title+r.username+r.address+r.password+r.remark,xt=(r,e)=>Re(r)===Re(e),xe=()=>{let r=location.origin;return r.startsWith("file://")&&(r+=location.pathname),r},vs=(r,e)=>{if(!r)return"";let t=r.replace("rgb","rgba");return t=t.replace(")",","+e+")"),t};let _t=Date.now();const Oe=()=>_t++,Lt=r=>xe()+"/#/login?type="+r.loginType+"&autoLogin="+P("password-xl",JSON.stringify(r)),kt=()=>v.lib.WordArray.random(8).toString(v.enc.Hex),Ds=()=>!!window.crypto.subtle,bs=r=>{const e=r;if(!e)return!1;const t=e.tagName?.toLowerCase();return t==="input"||t==="textarea"||t==="select"||e.isContentEditable?!0:e.getAttribute?.("role")==="textbox"},Pe={apiServer:"https://ai.password-xl.cn",publicKey:`-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvoEZ2yxmxt4mp8ipUmlI
4re+2MLfKcNacXeFOQWh8C3TxumN7I2CLieBX5zRTUfJJalsWlvUjsrXB8NXGjpJ
jqCQWGz+qC4N4UcAwW1olZOM2OBHD+eDtu/GlyBUp9Arf5BblXZcURbMWmh4V821
P7u2ChzxtR/EO107fZGgOcsS7o0LDa9f+Jy7uwhxCJlwoOyC5bCjCZIiayqGRkXx
x75c/i9OcRhovP+oE0eDkwsjBaP5nqUDufxLXUOD0RVOnchlpxS+9Fc58F5nZ4bx
FgAs4rSkgfZ4yc2DyvASc1iu9grjxpLA3ZDmH3L7PLv/ifyFeELlojd2VFzSl0qJ
PwIDAQAB
-----END PUBLIC KEY-----
`},It=async(r,e=!1)=>{let t=ze({length:16,number:!0,lowercase:!0,uppercase:!0,symbol:!1});return new Promise(async(s,a)=>{let o=await mt(Pe.publicKey,t),i=JSON.stringify({text:r}),n=P(t,i),u={encryptKey:o,data:n,batch:e};V.post(Pe.apiServer+"/extractPassword",u).then(l=>{let d=l.data;if(d.code!==200){a(d.message);return}let m=x(t,d.data);s(m)}).catch(l=>{a("提取密码失败")})})},Ft={"element-loading-text":"正在处理..."},Rt={style:{"margin-top":"10px"}},Ot=Y({__name:"AiAddPassword",setup(r,{expose:e}){const t=q(),s=f({vis:!1,loading:!1,text:""}),a=()=>{s.value.text="",s.value.loading=!1,s.value.vis=!0},o=()=>{s.value.loading=!0,It(s.value.text).then(i=>{t.passwordFormRef.addPasswordForm(),t.passwordFormRef.setPasswordForm(JSON.parse(i)),s.value.vis=!1,s.value.loading=!1,s.value.text=""}).catch(i=>{s.value.loading=!1,E.error({title:"系统异常",message:i})})};return e({show:a}),(i,n)=>{const u=Ae,l=Te,d=Ee,m=Ne,h=Je;return N(),X(m,{modelValue:g(s).vis,"onUpdate:modelValue":n[1]||(n[1]=p=>g(s).vis=p),width:["xs","sm"].includes(g(ne)().value)?"95%":"550px",title:"AI创建密码"},{footer:D(()=>[b(d,{disabled:!g(s).text||g(s).loading,plain:"",type:"primary",onClick:o},{default:D(()=>[...n[4]||(n[4]=[R(" Ai解析 ",-1)])]),_:1},8,["disabled"])]),default:D(()=>[Be((N(),U("div",Ft,[b(u,{type:"info"},{default:D(()=>[...n[2]||(n[2]=[R(" 你可以直接粘贴包含账号密码信息的字符串，Ai大模型将自动解析您的密码 ",-1)])]),_:1}),F("div",Rt,[b(l,{modelValue:g(s).text,"onUpdate:modelValue":n[0]||(n[0]=p=>g(s).text=p),rows:6,placeholder:"请粘贴账号密码到这里",type:"textarea"},null,8,["modelValue"])]),b(u,{size:"small",type:"danger"},{default:D(()=>[...n[3]||(n[3]=[R(" 您的密码信息将在加密后传输至Ai大模型进行处理，密码信息不会以任何形式进行存储 ",-1)])]),_:1})])),[[h,g(s).loading]])]),_:1},8,["modelValue","width"])}}}),Mt={style:{"margin-top":"5px"}},Bt={style:{"margin-top":"10px"}},Ut={style:{"margin-top":"5px"}},Gt=Y({__name:"FastLogin",setup(r,{expose:e}){const t=Ve(),s=f(""),a=f(!1),o=u=>{if(location.href.indexOf("autoLogin")!==-1||window.electronAPI||window.androidAPI){t.push("/");return}s.value=Lt(u),a.value=!0},i=u=>JSON.parse(x("password-xl",u)),n=()=>{a.value=!1,t.push("/")};return e({fastLoginTip:o,getFastLoginForm:i}),(u,l)=>{const d=Ae,m=Te,h=Ee,p=Ne;return N(),X(p,{modelValue:g(a),"onUpdate:modelValue":l[0]||(l[0]=A=>Ue(a)?a.value=A:null),"append-to-body":!0,fullscreen:["xs","sm"].includes(g(ne)().value),width:"700px"},{header:D(()=>[b(d,{size:"large",style:{"user-select":"none"}},{default:D(()=>[...l[1]||(l[1]=[F("span",{class:"iconfont icon-verify"},null,-1),R(" 登录成功 ",-1)])]),_:1})]),footer:D(()=>[b(h,{type:"primary",onClick:n},{default:D(()=>[...l[4]||(l[4]=[R("好的",-1)])]),_:1})]),default:D(()=>[F("div",null,[b(d,{type:"info"},{default:D(()=>[...l[2]||(l[2]=[R("以下链接可以自动输入登录信息，您可以保存此链接以防丢失：",-1)])]),_:1})]),F("div",Mt,[b(m,{"model-value":g(s),rows:7,type:"textarea"},null,8,["model-value"])]),F("div",Bt,[b(d,{type:"info"},{default:D(()=>[...l[3]||(l[3]=[R("该链接为password-XL首页地址，您可以收藏：",-1)])]),_:1})]),F("div",Ut,[b(m,{"model-value":g(xe)(),readonly:""},null,8,["model-value"])])]),_:1},8,["modelValue","fullscreen"])}}}),$e=(r,e)=>{const t=r.__vccOpts||r;for(const[s,a]of e)t[s]=a;return t},Kt=$e(Gt,[["__scopeId","data-v-f7fd9401"]]),Jt=Y({__name:"GesturePassword",props:{ciphertext:{type:String},showGesture:{type:Boolean,default:!0}},emits:["complete","pass","fail"],setup(r,{emit:e}){const t=L(),s=e;let a=r;const o=re([]),i=re([]),n=f(),u=f();let l;const d=f(!1),m=f(""),h=f(null),p={pointCellSize:3,cellPointRadio:.33,gesturePointColor:"#cacaca",circleCenterRadio:.25,gesturePointCenterColor:"#409EFF",gesturePointCenterErrorColor:"#F56C6C",lineWidth:12,lineColor:"rgba(64,158,255,0.32)",lineErrorColor:"rgba(245,108,108,0.32)"},A=c=>{M()},k=c=>{M()},_=()=>{let c=i.map(S=>S.id).join();le(c),M()},le=c=>{if(!a.ciphertext){if(i.length=0,c.length<5){G.warning("请至少连接3个点");return}s("complete",De(c));return}m.value=t.passwordManager.verifyPassword(c,a.ciphertext)?"pass":"fail",M(),m.value?s("pass",De(c)):s("fail",De(c)),setTimeout(()=>{m.value="",i.length=0,M()},500)},M=()=>{!n.value||!u.value||(ue(),ce(),fe(),a.showGesture&&(T(),de(),Q()))},Q=()=>{if(!l)return;let c=[...i];if(h.value&&d.value&&!m.value&&c.push(h.value),!(c.length<2))for(let S=1;S<c.length;S++){let C=c[S-1],I=c[S];l.beginPath(),l.strokeStyle=m.value==="fail"?p.lineErrorColor:p.lineColor,l.lineWidth=p.lineWidth,l.moveTo(C.x,C.y),l.lineTo(I.x,I.y),l.stroke()}},ue=()=>{if(!d.value||m.value==="fail")return;let c=y();if(!c)return;i.find(C=>C.id===c.id)||i.push(c)},ce=()=>{!l||!u.value||l.clearRect(0,0,u.value.width,u.value.height)},de=()=>{if(!(!n.value||!u.value||!l))for(let c=0;c<i.length;c++){let S=i[c];$(S)}},T=()=>{if(!n.value||!u.value||!l||m.value||!h.value)return;let c=y();c&&$(c)},y=()=>{if(!n.value||!u.value||!l||!h.value)return null;for(let c=0;c<o.length;c++){let S=o[c];if(Nt(S.x,S.y,S.radius,h.value.x,h.value?.y))return S}return null},$=c=>{l&&(l.beginPath(),l.fillStyle=m.value?p.gesturePointCenterErrorColor:p.gesturePointCenterColor,l.arc(c.x,c.y,c.radius*p.circleCenterRadio,0,Math.PI*2),l.fill(),l.beginPath(),l.fillStyle=m.value?p.lineErrorColor:p.lineColor,l.arc(c.x,c.y,c.radius*p.circleCenterRadio*2,0,Math.PI*2),l.fill(),l.beginPath(),l.strokeStyle=m.value?p.gesturePointCenterErrorColor:p.gesturePointCenterColor,l.lineWidth=2,l.arc(c.x,c.y,c.radius,0,Math.PI*2),l.stroke())},fe=()=>{l&&o.forEach(c=>{l&&(l.beginPath(),l.strokeStyle=p.gesturePointColor,l.lineWidth=2,l.arc(c.x,c.y,c.radius,0,Math.PI*2),l.stroke(),l.beginPath(),l.fillStyle=p.gesturePointColor,l.arc(c.x,c.y,c.radius*p.circleCenterRadio,0,Math.PI*2),l.fill())})},ge=c=>{d.value=!0;let S={x:c.offsetX,y:c.offsetY};h.value=S,A()},he=c=>{let S={x:c.offsetX,y:c.offsetY};h.value=S,k()},pe=()=>{d.value&&(d.value=!1,h.value=null,_())},me=()=>{d.value&&(d.value=!1,h.value=null,_())},ye=c=>{if(!u.value)return;d.value=!0;let S=u.value.getBoundingClientRect(),C={x:c.touches[0].clientX-S.x,y:c.touches[0].clientY-S.y};h.value=C,A()},we=c=>{if(!u.value)return;let S=u.value.getBoundingClientRect(),C={x:c.touches[0].clientX-S.x,y:c.touches[0].clientY-S.y};h.value=C,k()},J=()=>{d.value&&(d.value=!1,h.value=null,_())};function Xe(c,S,C){const I=window.devicePixelRatio||1;c.width=S*I,c.height=C*I,c.style.width=`${S}px`,c.style.height=`${C}px`;const ee=c.getContext("2d");return ee.scale(I,I),ee}const Le=()=>{if(!n.value||!u.value)return;let c=n.value.clientWidth;u.value.width=c,u.value.height=c,l=Xe(u.value,c,c);let S=0;o.length=0;for(let C=0;C<p.pointCellSize;C++)for(let I=0;I<p.pointCellSize;I++){let ee=C*c/p.pointCellSize,Ye=I*c/p.pointCellSize,ke=c/p.pointCellSize,Ze=c/p.pointCellSize,qe={id:S++,x:ee+ke/2,y:Ye+Ze/2,radius:ke*p.cellPointRadio};o.push(qe)}M()};let Se=null;return window.onresize=()=>{Se&&clearTimeout(Se),Se=setTimeout(Le,100)},Qe(()=>{Me(()=>{Le()})}),(c,S)=>(N(),U("div",{ref_key:"gestureDivRef",ref:n,style:{width:"100%",height:"100%"}},[F("canvas",{ref_key:"canvasRef",ref:u,style:{"image-rendering":"auto"},onMousedown:ge,onMouseleave:me,onMousemove:he,onMouseup:pe,onTouchend:J,onTouchmove:we,onTouchstart:ye},null,544)],512))}}),Vt={key:0,style:{margin:"20px"}},jt={key:1,style:{margin:"20px"}},zt={style:{display:"flex","justify-content":"space-between"}},$t=Y({__name:"VerifyMainPassword",setup(r,{expose:e}){const t=Ve(),s=L(),a=K(),o=f(),i=f(),n=f(!1),u=f(null),l=f(""),d=f(JSON.parse(JSON.stringify(s.mainPasswordType))),m=f(),h=re({mainPassword:""}),p=re({mainPassword:[{required:!0,message:"请输入主密码",trigger:"change"}]}),A=(T,y)=>(d.value=y||s.mainPasswordType,l.value="getAndVerify",m.value=T,y===j.STANDARD&&i.value?.resetFields(),h.mainPassword="",n.value=!0,new Promise($=>u.value=$)),k=()=>(d.value=s.mainPasswordType,l.value="verifyAndUnlock",s.mainPasswordType===j.STANDARD&&i.value?.resetFields(),h.mainPassword="",n.value=!0,new Promise(async T=>u.value=T)),_=T=>{T.validate(y=>{if(!y){o.value.focus();return}l.value==="getAndVerify"?M():l.value==="verifyAndUnlock"&&Q()})},le=T=>{h.mainPassword=T,l.value==="getAndVerify"?M():l.value==="verifyAndUnlock"&&Q()},M=()=>{if(!m.value){n.value=!1,u.value&&u.value(h.mainPassword);return}try{if(!m.value(h.mainPassword)){G.error("验证失败");return}}catch{G.error("验证失败");return}n.value=!1,u.value&&u.value(h.mainPassword)},Q=()=>{if(!s.passwordManager.verifyPassword(h.mainPassword)){G.error("验证失败");return}if(!s.passwordManager.unlock(h.mainPassword)){G.error("验证失败");return}n.value=!1,u.value&&u.value(h.mainPassword)},ue=()=>{n.value=!1,t.push("/login")},ce=()=>{d.value===j.STANDARD&&o.value?.focus()},de=()=>s.serviceStatus===w.NO_LOGIN&&localStorage.getItem("showGesture")==="false"?!1:a.setting.verifyShowGesture;return e({getAndVerify:A,verifyAndUnlock:k}),(T,y)=>{const $=Ae,fe=Te,ge=it,he=ot,pe=Jt,me=nt,ye=Ee,we=Ne;return N(),X(we,{modelValue:g(n),"onUpdate:modelValue":y[4]||(y[4]=J=>Ue(n)?n.value=J:null),"close-on-click-modal":g(s).serviceStatus!==g(w).NO_LOGIN,"close-on-press-escape":g(s).serviceStatus!==g(w).NO_LOGIN,"show-close":g(s).serviceStatus!==g(w).NO_LOGIN,width:["xs","sm"].includes(g(ne)().value)?"95%":"400px",top:"20vh",onOpen:y[5]||(y[5]=J=>g(i)?.resetFields()),onOpened:ce},{header:D(()=>[b($,{size:"large",style:{"user-select":"none"}},{default:D(()=>[y[8]||(y[8]=F("span",{class:"iconfont icon-verify"},null,-1)),g(s).serviceStatus===g(w).NO_LOGIN?(N(),U(Ge,{key:0},[y[6]||(y[6]=R("自动登录",-1)),y[7]||(y[7]=F("span",{style:{"font-weight":"bold"}}," · ",-1))],64)):z("",!0),y[9]||(y[9]=R(" 验证主密码 ",-1))]),_:1})]),footer:D(()=>[F("div",zt,[F("div",null,[g(s).serviceStatus===g(w).NO_LOGIN?(N(),X(me,{key:0,underline:!1,type:"primary",onClick:ue},{default:D(()=>[...y[10]||(y[10]=[R("返回登录页 ",-1)])]),_:1})):z("",!0)]),g(d)===g(j).STANDARD?(N(),X(ye,{key:0,type:"primary",onClick:y[3]||(y[3]=J=>_(g(i)))},{default:D(()=>[...y[11]||(y[11]=[R(" 确定 ",-1)])]),_:1})):z("",!0)])]),default:D(()=>[g(d)===g(j).STANDARD?(N(),U("div",Vt,[b(he,{ref_key:"formRef",ref:i,model:g(h),rules:g(p),onSubmit:y[2]||(y[2]=et(()=>{},["prevent"]))},{default:D(()=>[b(ge,{prop:"mainPassword"},{default:D(()=>[b(fe,{ref_key:"passwordInputRef",ref:o,modelValue:g(h).mainPassword,"onUpdate:modelValue":y[0]||(y[0]=J=>g(h).mainPassword=J),autocomplete:"new-password",placeholder:"请输入主密码","show-password":"",type:"password",onKeyup:y[1]||(y[1]=tt(J=>_(g(i)),["enter","native"]))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])):z("",!0),g(d)===g(j).GESTURE?(N(),U("div",jt,[b(pe,{"show-gesture":de(),onComplete:le},null,8,["show-gesture"])])):z("",!0)]),_:1},8,["modelValue","close-on-click-modal","close-on-press-escape","show-close","width"])}}}),Ht=$e($t,[["__scopeId","data-v-26ea6b62"]]),Wt="data:image/svg+xml,%3csvg%20version='1.1'%20baseProfile='full'%20width='100%25'%20height='100%25'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201400%20800'%20%3e%3crect%20x='1300'%20y='400'%20rx='40'%20ry='40'%20width='300'%20height='300'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='0%201450%20550'%20to='360%201450%20550'%20repeatCount='indefinite'/%3e%3c/rect%3e%3cpath%20d='M%20100%20350%20A%20150%20150%200%201%201%20400%20350%20Q400%20370%20380%20370%20L%20250%20370%20L%20120%20370%20Q100%20370%20100%20350'%20stroke='rgb(253,%20214,%2099)'%20fill='rgb(253,%20214,%2099)'%3e%3canimateMotion%20path='M%20800%20-200%20L%20800%20-300%20L%20800%20-200'%20dur='20s'%20begin='0s'%20repeatCount='indefinite'/%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20values='0%20210%20530%20;%20-30%20210%20530%20;%200%20210%20530'%20keyTimes='0%20;%200.5%20;%201'%20repeatCount='indefinite'/%3e%3c/path%3e%3ccircle%20cx='200'%20cy='150'%20r='20'%20stroke='%231a73e8'%20fill='%231a73e8'%3e%3canimateMotion%20path='M%200%200%20L%2040%2020%20Z'%20dur='5s'%20repeatCount='indefinite'/%3e%3c/circle%3e%3c!--%20三角形%20--%3e%3cpath%20d='M%20165%20580%20L%20270%20580%20Q275%20578%20270%20570%20L%20223%20483%20Q220%20480%20217%20483%20L%20165%20570%20Q160%20578%20165%20580'%20stroke='rgb(238,%20103,%2092)'%20fill='rgb(238,%20103,%2092)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='0%20210%20530'%20to='360%20210%20530'%20repeatCount='indefinite'/%3e%3c/path%3e%3ccircle%20cx='1200'%20cy='600'%20r='30'%20stroke='rgb(241,%20243,%20244)'%20fill='rgb(241,%20243,%20244)'%3e%3canimateMotion%20path='M%200%200%20L%20-20%2040%20Z'%20dur='9s'%20repeatCount='indefinite'/%3e%3c/circle%3e%3cpath%20d='M%20100%20350%20A%2040%2040%200%201%201%20180%20350%20L%20180%20430%20A%2040%2040%200%201%201%20100%20430%20Z'%20stroke='rgb(241,%20243,%20244)'%20fill='rgb(241,%20243,%20244)'%3e%3canimateMotion%20path='M%20140%20390%20L%20180%20360%20L%20140%20390'%20dur='20s'%20begin='0s'%20repeatCount='indefinite'/%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20values='0%20140%20390;%20-60%20140%20390;%200%20140%20390'%20keyTimes='0%20;%200.5%20;%201'%20repeatCount='indefinite'/%3e%3c/path%3e%3crect%20x='900'%20y='600'%20rx='30'%20ry='30'%20width='90'%20height='90'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='50s'%20type='rotate'%20from='0%20900%20550'%20to='360%20900%20550'%20repeatCount='indefinite'/%3e%3c/rect%3e%3c/svg%3e",Xt="data:image/svg+xml,%3csvg%20version='1.1'%20baseProfile='full'%20width='100%25'%20height='100%25'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20800%201400'%20%3e%3c!--%20绿色大方块--%3e%3crect%20x='700'%20y='1000'%20rx='40'%20ry='40'%20width='300'%20height='300'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%20style='transform-box:fill-box;%20transform-origin:center;'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='0%200%200'%20to='360%200%200'%20repeatCount='indefinite'/%3e%3c/rect%3e%3c!--%20白色椭圆--%3e%3cpath%20d='M%20100%20350%20A%2040%2040%200%201%201%20180%20350%20L%20180%20430%20A%2040%2040%200%201%201%20100%20430%20Z'%20stroke='rgb(241,%20243,%20244)'%20fill='rgb(241,%20243,%20244)'%3e%3canimateMotion%20path='M%20240%20590%20L%20180%20360%20L%20240%20590'%20dur='20s'%20begin='0s'%20repeatCount='indefinite'/%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20values='0%20140%20390;%20-60%20140%20390;%200%20140%20390'%20keyTimes='0%20;%200.5%20;%201'%20repeatCount='indefinite'/%3e%3c/path%3e%3c!--%20绿色小方块--%3e%3crect%20x='400'%20y='600'%20rx='40'%20ry='40'%20width='100'%20height='100'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='-30%20550%20750'%20to='330%20550%20750'%20repeatCount='indefinite'/%3e%3c/rect%3e%3csvg%20viewBox='0%200%201024%201024'%20version='1.1'%20x='100'%20y='1100'%20xmlns='http://www.w3.org/2000/svg'%20width='200px'%20height='200px'%3e%3cpath%20d='M225.28%20163.84h573.44c45.056%200%2081.92%2036.864%2081.92%2081.92v450.56c0%2045.056-36.864%2081.92-81.92%2081.92H225.28c-45.056%200-81.92-36.864-81.92-81.92V245.76c0-45.056%2036.864-81.92%2081.92-81.92z%20m430.08%20450.56c79.872%200%20143.36-63.488%20143.36-143.36s-63.488-143.36-143.36-143.36-143.36%2063.488-143.36%20143.36%2063.488%20143.36%20143.36%20143.36z%20m0-81.92c34.816%200%2061.44-26.624%2061.44-61.44s-26.624-61.44-61.44-61.44-61.44%2026.624-61.44%2061.44%2026.624%2061.44%2061.44%2061.44z'%20fill='%230af1f4'%20style='transform-box:fill-box;%20transform-origin:center;'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20from='0%200%200'%20to='360%200%200'%20repeatCount='indefinite'/%3e%3c/path%3e%3c/svg%3e%3c/svg%3e",Yt={key:0,alt:"",class:"back-img hidden-xs-only",src:Wt},Zt={key:1,alt:"",class:"back-img hidden-sm-and-up",src:Xt},qt=["element-loading-text"],Qt=Y({__name:"App",setup(r){const e=q(),t=K(),s=L();let a=localStorage.getItem("topicMode")||"auto";s.setTopicMode(a),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{let u=localStorage.getItem("topicMode")||"auto";s.setTopicMode(u)});const i=f(!1);return(()=>{let u=localStorage.getItem("dynamicBackground");(!u||u==="true")&&(i.value=!0)})(),st(()=>t.setting.dynamicBackground,u=>{localStorage.setItem("dynamicBackground",u.toString()),i.value=t.setting.dynamicBackground}),(u,l)=>{const d=rt("router-view"),m=Ht,h=Kt,p=Ot,A=ut,k=Je;return N(),U(Ge,null,[g(i)?(N(),U("img",Yt)):z("",!0),g(i)?(N(),U("img",Zt)):z("",!0),Be((N(),U("div",{id:"password-app","element-loading-text":g(s).globalLoading.content,onClick:l[0]||(l[0]=_=>g(s).resetTimeoutLock())},[b(A,{locale:g(lt)},{default:D(()=>[b(d),b(m,{ref:_=>g(e).verifyPasswordRef=_},null,512),b(h,{ref:_=>g(e).fastLoginRef=_},null,512),b(p,{ref:_=>g(e).aiAddPasswordRef=_},null,512)]),_:1},8,["locale"])],8,qt)),[[k,g(s).globalLoading.vis]])],64)}}}),es=[{path:"/",name:"Index",component:()=>se(()=>import("./IndexPage-lJfzWKne.js"),__vite__mapDeps([8,4,3,2,1,5,6,9,10,7,11]),import.meta.url)},{path:"/login",name:"Login",component:()=>se(()=>import("./LoginPage-DutXP21C.js").then(r=>r.L),__vite__mapDeps([12,4,3,2,1,5,6,9,13]),import.meta.url)},{path:"/note",name:"Note",component:()=>se(()=>import("./NotePage-D1I74k-p.js"),__vite__mapDeps([14,4,3,2,1,5,6,10,15,16,7,17]),import.meta.url)}],ts=[w.LOGGED,w.WAIT_INIT,w.UNLOCKED],He=ct({history:dt(),routes:es});He.beforeEach((r,e,t)=>{if(r.path==="/login"){oe().logging=!1,t();return}let s=L();const a=K();if(ts.includes(s.serviceStatus)){t();return}if(!a.setting.autoLogin||r.path.startsWith("/login")){t("/login");return}try{oe().autoLogin().then(o=>{o?t():t("/login")})}catch{t("/login")}});const ss=({options:r,store:e})=>{e.$resetFields=t=>{const{state:s}=r;let a=s?s():{};e.$patch(o=>{t&&(a=ft(a,t)),Object.assign(o,a)})}},We=gt();We.use(ss);let _e=at(Qt);_e.use(He);_e.use(We);_e.mount("#app");V.get(Pe.apiServer+"/getVersion",{withCredentials:!0}).then(r=>{}).catch(r=>{});export{us as A,cs as B,ds as C,gs as D,fs as E,ie as F,se as G,Dt as H,vt as I,bt as J,Ct as K,Pt as L,j as M,kt as N,He as O,B as P,ws as Q,Ss as R,w as S,O as T,hs as U,$e as _,q as a,K as b,xt as c,ne as d,It as e,je as f,bs as g,At as h,Oe as i,oe as j,Lt as k,ae as l,P as m,H as n,Jt as o,Et as p,ys as q,Ce as r,Ds as s,x as t,L as u,yt as v,ps as w,ms as x,ze as y,vs as z};
