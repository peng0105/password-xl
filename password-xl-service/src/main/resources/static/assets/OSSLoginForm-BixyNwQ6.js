import{n as L,g as x,h as v,d as B,e as O,i as C,m as R,E as K}from"./element-plus-DfJ8pmrs.js";import{_ as N}from"./LoginPage-BlTwbWdu.js";import{d as T,r as U,S as w,c as h,o as A,a as y,D as s,B as _,v as l,u as t,aa as J,F as D}from"./@vue-BhCi5Yj9.js";import{_ as P}from"./local-DhpgDmJL.js";import{u as $,e as M,a as j,i as z,h as G,_ as H}from"./index-DZ5-n0Cs.js";import{a1 as Q}from"./vendor-B4nIbczL.js";import{DatabaseForOSS as W}from"./DatabaseForOSS-DxJ0Ey6E.js";import"./@element-plus-C1_C3qTM.js";import"./cos-js-sdk-v5-B8_2Tx6c.js";import"./ali-oss-B_Q55M9i.js";const X={class:"register-guide"},Y=T({__name:"OSSLoginForm",setup(Z){const a=Q(),k=$(),c=M(),S=j(),d=U(),e=w({region:"",accessKeyId:"",accessKeySecret:"",bucket:""}),E=w({region:[{required:!0,message:"请输入region",trigger:"blur"}],accessKeyId:[{required:!0,message:"请输入accessKeyId",trigger:"blur"}],accessKeySecret:[{required:!0,message:"请输入accessKeySecret",trigger:"blur"}],bucket:[{required:!0,message:"请输入bucket",trigger:"blur"},{min:3,message:"请检查bucket",trigger:"blur"}]}),b=async u=>{console.log("oss 点击登录"),await u.validate(async o=>{if(o){c.logging=!0;try{let g=new W,i=await g.login(e);if(console.log("oss 登录 数据库登录结果：",i),!i.status){c.logging=!1,K.error({title:"登录失败",message:i.message});return}c.loginForm=e,console.log("oss 登录 初始化密码管理器"),k.passwordManager.login(g).then(r=>{if(!r.status){c.logging=!1,console.log("oss 登录 登录失败: ",r),K.error({title:"登录失败",message:r.message});return}let p=z(),m=JSON.parse(JSON.stringify(e));m.loginType=c.loginType;let f=G(p,JSON.stringify(m));sessionStorage.setItem("loginForm",f),console.log("oss 登录 触发快速登录提示"),S.fastLoginRef.fastLoginTip(m)}).catch(r=>{console.error(r),c.logging=!1})}catch{c.logging=!1}}})},F=()=>{if(a.query.type==="oss"&&a.query.autoLogin){let u=S.fastLoginRef.getFastLoginForm(a.query.autoLogin);e.region=u.region||"",e.accessKeyId=u.accessKeyId||"",e.accessKeySecret=u.accessKeySecret||"",e.bucket=u.bucket||""}else e.region=(a.query.region||"")+"",e.accessKeyId=(a.query.accessKeyId||"")+"",e.accessKeySecret=(a.query.accessKeySecret||"")+"",e.bucket=(a.query.bucket||"")+""},I=()=>!(a.query.autoLogin&&a.query.type==="oss");return F(),(u,o)=>{const g=N,i=B,r=v,p=x,m=O,f=C,V=L,q=R;return A(),h(D,null,[o[8]||(o[8]=y("div",{class:"login-title"},[y("img",{alt:"",src:P}),_(" 阿里云OSS登录 ")],-1)),s(g,{class:"input-login-line hidden-xs-only",text:"请输入登录信息"}),s(q,{class:"login-form-row"},{default:l(()=>[s(V,{sm:{span:20,offset:2},xs:{span:24}},{default:l(()=>[s(p,{ref_key:"formRef",ref:d,model:t(e),rules:t(E)},{default:l(()=>[s(r,{prop:"region"},{default:l(()=>[s(i,{modelValue:t(e).region,"onUpdate:modelValue":o[0]||(o[0]=n=>t(e).region=n),clearable:"",placeholder:"region"},null,8,["modelValue"])]),_:1}),s(r,{prop:"accessKeyId"},{default:l(()=>[s(i,{modelValue:t(e).accessKeyId,"onUpdate:modelValue":o[1]||(o[1]=n=>t(e).accessKeyId=n),clearable:"",placeholder:"accessKeyId"},null,8,["modelValue"])]),_:1}),s(r,{prop:"accessKeySecret"},{default:l(()=>[s(i,{modelValue:t(e).accessKeySecret,"onUpdate:modelValue":o[2]||(o[2]=n=>t(e).accessKeySecret=n),"show-password":I(),placeholder:"accessKeySecret",type:"password"},null,8,["modelValue","show-password"])]),_:1}),s(r,{prop:"bucket"},{default:l(()=>[s(i,{modelValue:t(e).bucket,"onUpdate:modelValue":o[3]||(o[3]=n=>t(e).bucket=n),clearable:"",placeholder:"bucket",onKeyup:o[4]||(o[4]=J(n=>b(t(d)),["enter","native"]))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),s(m,{class:"login-btn",plain:"",round:"",type:"primary",onClick:o[5]||(o[5]=n=>b(t(d)))},{default:l(()=>[...o[6]||(o[6]=[_(" 登 录 ",-1)])]),_:1}),y("div",X,[s(f,{underline:!1,href:"https://gitee.com/huanyp/password-xl/wikis/%E9%98%BF%E9%87%8C%E4%BA%91OSS%E6%B3%A8%E5%86%8C%E6%8C%87%E5%BC%95",target:"_blank",type:"primary"},{default:l(()=>[...o[7]||(o[7]=[_("阿里云OSS注册指引 ",-1)])]),_:1})])]),_:1})]),_:1})],64)}}}),ue=H(Y,[["__scopeId","data-v-c0e90c99"]]);export{ue as default};
