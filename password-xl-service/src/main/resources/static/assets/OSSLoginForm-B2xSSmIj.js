import{p as L,g as x,h as v,d as B,e as O,i as C,o as R,E as K}from"./element-plus-C8kBqzPU.js";import{_ as N}from"./LoginPage-N6BuoTDg.js";import{d as T,r as U,S as w,c as A,o as J,a as y,D as s,B as _,v as n,u as t,aa as h,F as D}from"./@vue-PmY8Mkr0.js";import{_ as P}from"./local-DhpgDmJL.js";import{u as $,j,a as M,n as z,m as G,_ as H}from"./index-DDbEbXNX.js";import{a1 as Q}from"./vendor-BvEI7uIN.js";import{DatabaseForOSS as W}from"./DatabaseForOSS-KtWBoWx_.js";import"./@element-plus-CuK1irWX.js";import"./cos-js-sdk-v5-WX9VGj_f.js";import"./ali-oss-CN0NZiD5.js";const X={class:"register-guide"},Y=T({__name:"OSSLoginForm",setup(Z){const r=Q(),k=$(),i=j(),S=M(),p=U(),e=w({region:"",accessKeyId:"",accessKeySecret:"",bucket:""}),E=w({region:[{required:!0,message:"请输入region",trigger:"blur"}],accessKeyId:[{required:!0,message:"请输入accessKeyId",trigger:"blur"}],accessKeySecret:[{required:!0,message:"请输入accessKeySecret",trigger:"blur"}],bucket:[{required:!0,message:"请输入bucket",trigger:"blur"},{min:3,message:"请检查bucket",trigger:"blur"}]}),b=async c=>{await c.validate(async o=>{if(o){i.logging=!0;try{let g=new W,u=await g.login(e);if(!u.status){i.logging=!1,K.error({title:"登录失败",message:u.message});return}i.loginForm=e,k.passwordManager.login(g).then(l=>{if(!l.status){i.logging=!1,K.error({title:"登录失败",message:l.message});return}let d=z(),m=JSON.parse(JSON.stringify(e));m.loginType=i.loginType;let f=G(d,JSON.stringify(m));sessionStorage.setItem("loginForm",f),S.fastLoginRef.fastLoginTip(m)}).catch(l=>{i.logging=!1})}catch{i.logging=!1}}})},F=()=>{if(r.query.type==="oss"&&r.query.autoLogin){let c=S.fastLoginRef.getFastLoginForm(r.query.autoLogin);e.region=c.region||"",e.accessKeyId=c.accessKeyId||"",e.accessKeySecret=c.accessKeySecret||"",e.bucket=c.bucket||""}else e.region=(r.query.region||"")+"",e.accessKeyId=(r.query.accessKeyId||"")+"",e.accessKeySecret=(r.query.accessKeySecret||"")+"",e.bucket=(r.query.bucket||"")+""},I=()=>!(r.query.autoLogin&&r.query.type==="oss");return F(),(c,o)=>{const g=N,u=B,l=v,d=x,m=O,f=C,V=L,q=R;return J(),A(D,null,[o[8]||(o[8]=y("div",{class:"login-title"},[y("img",{alt:"",src:P}),_(" 阿里云OSS登录 ")],-1)),s(g,{class:"input-login-line hidden-xs-only",text:"请输入登录信息"}),s(q,{class:"login-form-row"},{default:n(()=>[s(V,{sm:{span:20,offset:2},xs:{span:24}},{default:n(()=>[s(d,{ref_key:"formRef",ref:p,model:t(e),rules:t(E)},{default:n(()=>[s(l,{prop:"region"},{default:n(()=>[s(u,{modelValue:t(e).region,"onUpdate:modelValue":o[0]||(o[0]=a=>t(e).region=a),clearable:"",placeholder:"region"},null,8,["modelValue"])]),_:1}),s(l,{prop:"accessKeyId"},{default:n(()=>[s(u,{modelValue:t(e).accessKeyId,"onUpdate:modelValue":o[1]||(o[1]=a=>t(e).accessKeyId=a),clearable:"",placeholder:"accessKeyId"},null,8,["modelValue"])]),_:1}),s(l,{prop:"accessKeySecret"},{default:n(()=>[s(u,{modelValue:t(e).accessKeySecret,"onUpdate:modelValue":o[2]||(o[2]=a=>t(e).accessKeySecret=a),"show-password":I(),placeholder:"accessKeySecret",type:"password"},null,8,["modelValue","show-password"])]),_:1}),s(l,{prop:"bucket"},{default:n(()=>[s(u,{modelValue:t(e).bucket,"onUpdate:modelValue":o[3]||(o[3]=a=>t(e).bucket=a),clearable:"",placeholder:"bucket",onKeyup:o[4]||(o[4]=h(a=>b(t(p)),["enter","native"]))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),s(m,{class:"login-btn",plain:"",round:"",type:"primary",onClick:o[5]||(o[5]=a=>b(t(p)))},{default:n(()=>[...o[6]||(o[6]=[_(" 登 录 ",-1)])]),_:1}),y("div",X,[s(f,{underline:!1,href:"https://gitee.com/huanyp/password-xl/wikis/%E9%98%BF%E9%87%8C%E4%BA%91OSS%E6%B3%A8%E5%86%8C%E6%8C%87%E5%BC%95",target:"_blank",type:"primary"},{default:n(()=>[...o[7]||(o[7]=[_("阿里云OSS注册指引 ",-1)])]),_:1})])]),_:1})]),_:1})],64)}}}),ue=H(Y,[["__scopeId","data-v-c0e90c99"]]);export{ue as default};
