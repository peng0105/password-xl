import{u as F,a as k,Q as x,p as i}from"./index-HOZrobza.js";import{E}from"./exceljs-eb77zzzs.js";import{a3 as y}from"./vendor-B4nIbczL.js";import{E as _}from"./element-plus-BZLLPOmQ.js";import{d as C}from"./@vue-BhCi5Yj9.js";import"./cos-js-sdk-v5-B8_2Tx6c.js";import"./ali-oss-B_Q55M9i.js";import"./@element-plus-C1_C3qTM.js";const A=C({__name:"ExportExcel",setup(S,{expose:u}){const c=F(),g=k(),p=["名称","地址","用户名","密码","标签","备注","创建时间","收藏","自定义信息"],d=async e=>{if(console.log("导出密码 downloadTemplate:",e),e){await n(e);return}g.verifyPasswordRef.getAndVerify(t=>c.passwordManager.verifyPassword(t)).then(()=>{console.log("导出密码 验证通过"),n(e)})},n=async e=>{console.log("导出密码，开始导出");const t=new E.Workbook,o=t.addWorksheet("Sheet1");if(o.addRow(p),!e){const r=c.allPasswordArray.map(s=>{let f="";s.labels&&s.labels.length&&(f=x(s.labels));let h=i(s.addTime,"YYYY-MM-DD HH:mm:ss"),l="";if(s.customFields&&s.customFields.length)for(let a=0;a<s.customFields.length;a++)l+=s.customFields[a].key+"："+s.customFields[a].val,a!==s.customFields.length-1&&(l+=`\r
`);return[s.title,s.address,s.username,s.password,f,s.remark,h,s.favorite?"是":"否",l]});console.log("导出密码，导出数据：",r.length),r.forEach(s=>{o.addRow(s)})}o.getRow(1).eachCell((r,s)=>{switch(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"00B0F0"}},r.font={bold:!0,color:{argb:"FFFFFF"}},s){case 1:o.getColumn(s).width=20;break;case 2:o.getColumn(s).width=30;break;case 3:case 4:case 5:case 6:case 7:o.getColumn(s).width=20;break;case 8:o.getColumn(s).width=10;break;case 9:o.getColumn(s).width=20;break}}),console.log("导出密码，将工作簿写入缓冲区");const m=await t.xlsx.writeBuffer(),w=new Blob([m],{type:"application/octet-stream"}),b=e?"密码导入模板.xlsx":"密码导出_"+i(Date.now(),"YYYY-MM-DD HH:mm:ss")+".xlsx";console.log("导出密码，保存"),y.saveAs(w,b),e||(console.log("导出密码，密码导出成功"),_.success({title:"密码导出成功",message:"请注意密码安全"}))};return u({exportExcel:d}),(e,t)=>null}});export{A as default};
