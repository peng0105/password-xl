const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DatabaseForOSS-DxJ0Ey6E.js","./ali-oss-B_Q55M9i.js","./vendor-B4nIbczL.js","./@vue-BhCi5Yj9.js","./element-plus-DfJ8pmrs.js","./@element-plus-C1_C3qTM.js","./element-plus-BUj08D2o.css","./cos-js-sdk-v5-B8_2Tx6c.js","./IndexPage-CVXll8PL.js","./local-DhpgDmJL.js","./logo-B_J9w6Yt.js","./IndexPage-CFwYGa3H.css","./LoginPage-BlTwbWdu.js","./LoginPage-OyMee8d9.css","./NotePage-DbpVI-7O.js","./aieditor-CfOwAmUy.js","./aieditor-C7A_tjCx.css","./NotePage-CFNlq5eI.css"])))=>i.map(i=>d[i]);
import{r as d,M as Me,d as Y,n as X,o as x,v as D,x as Be,c as U,D as b,a as F,B as O,u as g,j as Ue,S as oe,H as Qe,z,P as et,aa as tt,F as Ge,I as st,ad as ot,ao as rt}from"./@vue-BhCi5Yj9.js";import{E as T,a as Ke,b as G,c as Ae,d as Ee,v as Je,e as Te,f as xe,g as at,h as nt,i as it,z as lt,j as ct}from"./element-plus-DfJ8pmrs.js";import{R as S,U as Z,V,W as Se,X as Ve,Z as ut,_ as dt,p as gt,$ as ft}from"./vendor-B4nIbczL.js";import{C as ht}from"./cos-js-sdk-v5-B8_2Tx6c.js";import"./@element-plus-C1_C3qTM.js";import"./ali-oss-B_Q55M9i.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();var re=(s=>(s.ASC="ascending",s.DESC="descending",s))(re||{}),B=(s=>(s[s.NORMAL=0]="NORMAL",s[s.DELETED=1]="DELETED",s))(B||{}),R=(s=>(s.AUTO="auto",s.LIGHT="light",s.DARK="dark",s))(R||{}),je=(s=>(s[s.CARD=0]="CARD",s[s.TABLE=1]="TABLE",s))(je||{}),y=(s=>(s.NO_LOGIN="初始化",s.LOGGED="已登录",s.WAIT_INIT="待初始化",s.UNLOCKED="已解锁",s))(y||{}),j=(s=>(s.STANDARD="standard",s.GESTURE="gesture",s))(j||{});const H=()=>{let s="";try{s+=(Intl.DateTimeFormat().resolvedOptions().timeZone||"")+","}catch{}try{s+=(window.navigator.languages.join(",")||"")+",",s+=(window.navigator.hardwareConcurrency||"")+","}catch{}try{s+=(window.getComputedStyle(document.documentElement).fontFamily||"")+","}catch{}try{let e=document.createElement("canvas").getContext("webgl2");if(e){let t=e.getExtension("WEBGL_debug_renderer_info");t&&(s+=(e.getParameter(t.UNMASKED_RENDERER_WEBGL)||"")+",")}}catch{}return S.MD5(s).toString()},Ce=(s,e)=>{try{return!!N(s,e)}catch{return!1}};async function pt(s){const o=s.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s+/g,""),r=Uint8Array.from(atob(o),a=>a.charCodeAt(0));return crypto.subtle.importKey("spki",r.buffer,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"])}async function mt(s,e){const t=await pt(s),o=new TextEncoder().encode(e);let r=await crypto.subtle.encrypt({name:"RSA-OAEP"},t,o);function a(n){const i=new Uint8Array(n);let l="";for(let c=0;c<i.length;c++)l+=String.fromCharCode(i[c]);return btoa(l)}return a(r)}const A=(s,e)=>{const t=S.enc.Utf8.parse(e),o=S.enc.Utf8.parse(S.MD5(s).toString()),r=S.enc.Utf8.parse(S.MD5("password-xl").toString());return S.AES.encrypt(t,o,{iv:r,mode:S.mode.CBC,padding:S.pad.Pkcs7}).ciphertext.toString()},N=(s,e)=>{let t=S.enc.Hex.parse(e),o=S.enc.Base64.stringify(t);const r=S.enc.Utf8.parse(S.MD5(s).toString()),a=S.enc.Utf8.parse(S.MD5("password-xl").toString());return S.AES.decrypt(o,r,{iv:a,mode:S.mode.CBC,padding:S.pad.Pkcs7}).toString(S.enc.Utf8).toString()},De=s=>S.MD5(s).toString(),be=s=>{const e={},t=[];let o=0;for(let r=0;r<s.length;r++){const a=[];for(const n in s[r])e.hasOwnProperty(n)||(e[n]=o++),a[e[n]]=s[r][n];t.push(a)}return{keys:e,dataArray:t}},wt=s=>{const e=[];for(let t=0;t<s.dataArray.length;t++){const o=s.dataArray[t],r={};for(const a in s.keys){const n=o[s.keys[a]];n!==void 0&&(r[a]=n)}e.push(r)}return e},yt="modulepreload",vt=function(s,e){return new URL(s,e).href},Ie={},se=function(e,t,o){let r=Promise.resolve();if(t&&t.length>0){let c=function(f){return Promise.all(f.map(w=>Promise.resolve(w).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const n=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),l=i?.nonce||i?.getAttribute("nonce");r=c(t.map(f=>{if(f=vt(f,o),f in Ie)return;Ie[f]=!0;const w=f.endsWith(".css"),h=w?'[rel="stylesheet"]':"";if(o)for(let E=n.length-1;E>=0;E--){const k=n[E];if(k.href===f&&(!w||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${h}`))return;const p=document.createElement("link");if(p.rel=w?"stylesheet":yt,w||(p.as="script"),p.crossOrigin="",p.href=f,l&&p.setAttribute("nonce",l),document.head.appendChild(p),w)return new Promise((E,k)=>{p.addEventListener("load",E),p.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(n){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n}return r.then(n=>{for(const i of n||[])i.status==="rejected"&&a(i.reason);return e().catch(a)})};class St{fileNames={store:"password-xl/store.json",setting:"password-xl/setting.json",note:"password-xl/note.json"};fileEtags={};cosClient=null;region="";bucket="";async login(e){return console.log("登录腾讯云COS"),this.cosClient=new ht({SecretId:e.secretId,SecretKey:e.secretKey}),this.region=e.region,this.bucket=e.bucket,Promise.resolve({status:!0})}async getStoreData(){return this.getFile(this.fileNames.store)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){return new Promise((o,r)=>{if(!this.cosClient)throw new Error("cos getFile 存储引擎不存在");let a=e.name.split(".").pop(),n="/images/"+t+"/"+kt()+"."+a;this.cosClient.putObject({Bucket:this.bucket,Region:this.region,Key:n,Body:e},(i,l)=>{i?(console.error("cos上传图片错误：",i),T.error({title:"系统异常",message:this.errorDispose(i)}),r({status:!1,message:this.errorDispose(i)})):(console.log("cos上传图片成功：",l),o("https://"+this.bucket+".cos."+this.region+".myqcloud.com"+n))})})}async getFile(e){return console.log("获取cos文件：",e),new Promise((t,o)=>{if(!this.cosClient)throw new Error("cos getFile 存储引擎不存在");this.cosClient.getObject({Bucket:this.bucket,Region:this.region,Key:e},(r,a)=>{if(a){this.updateEtag(e,a.ETag),t(JSON.parse(a.Body.toString()));return}r&&r.statusCode===404?(console.log("cos 获取文件404"),t("")):(console.error("cos 获取文件错误：",r),T.error({title:"系统异常",message:this.errorDispose(r)}),o({status:!1,message:this.errorDispose(r)}))})})}async uploadFile(e,t){return console.log("上传cos文件：",e,t.length),new Promise(async(o,r)=>{if(!this.cosClient)throw new Error("cos uploadFile 存储引擎不存在");if(!await this.checkEtag(e)){console.log("上传cos文件 文件同步异常"),Ke({title:"文件同步异常",message:"当前密码列表已被其他客户端更新，请刷新页面",showCancelButton:!1,showConfirmButton:!0,closeOnPressEscape:!1,showClose:!1,closeOnClickModal:!1,confirmButtonText:"刷新",callback:()=>{console.log("刷新"),location.reload()}});return}this.cosClient.putObject({Bucket:this.bucket,Region:this.region,Key:e,Body:JSON.stringify(t)},(n,i)=>{n?(console.error("cos上传文件错误：",n),T.error({title:"系统异常",message:this.errorDispose(n)}),r({status:!1,message:this.errorDispose(n)})):(this.updateEtag(e,i.ETag),o({status:!0}))})})}async deleteFile(e){return console.log("删除cos文件：",e),new Promise((t,o)=>{if(!this.cosClient)throw new Error("cos deleteFile 存储引擎不存在");this.cosClient.deleteObject({Bucket:this.bucket,Region:this.region,Key:e},r=>{r?(console.error("cos删除文件错误：",r),T.error({title:"系统异常",message:this.errorDispose(r)}),o({status:!1,message:this.errorDispose(r)})):t({status:!0})})})}errorDispose(e){let t={"CORS blocked or network error":"有可能是存储桶（bucket）不存在、地域（region）错误、跨域配置错误","Access Denied.":"该账号无存储桶（bucket）权限或存储桶错误",'Bucket should format as "test-1250000000".':"存储桶（bucket）格式错误"};if(e){if(e.code==="InvalidAccessKeyId")return"账户（secretId）无效";if(e.code==="SignatureDoesNotMatch")return"密钥（secretKey）无效";if(e.code==="Error"){let o=t[e.message];return o||e.message}}return"COS登录异常-未知原因"}getEtag(e){return new Promise(async t=>{if(!this.cosClient)throw new Error("cos getEtag 存储引擎不存在");this.cosClient.headObject({Bucket:this.bucket,Region:this.region,Key:e},function(o,r){console.error(o),t(r.ETag)})})}async checkEtag(e){if(!this.fileEtags[e])return Promise.resolve(!0);let t=await this.getEtag(e);return this.fileEtags[e]===t}async updateEtag(e,t){this.fileEtags[e]=t}}const K=Z("settingStore",{state:()=>({visSetting:!1,setting:{autoGeneratePassword:!0,customFields:[],easyConfuseChat:"0OoIil",showLabelCard:!0,enableAiAdd:!0,showFavoriteCard:!0,enableRecycleBin:!1,enableShortcutKey:!0,generateRule:{length:16,lowercase:!0,number:!0,symbol:!0,uppercase:!0},showTimeForTable:"no",showLabelForTable:!0,showStrength:!0,sortOrder:re.DESC,sortField:"addTime",timeoutLock:0,verifyShowGesture:!0,passwordDisplayMode:je.CARD,autoLogin:!0,autoUnlock:!1,showPasswordStatistics:!1,showNote:!1,bgColors:["rgb(255,0,0)","rgb(255,136,0)","rgb(115,255,0)","rgb(0,208,255)","rgb(95,0,255)","rgb(178,0,255)","rgb(0,0,0)"],dynamicBackground:!0,passwordColor:!1}})}),q=Z("refStore",{state:()=>({verifyPasswordRef:d(),passwordFormRef:d(),cancelAccountRef:d(),settingRef:d(),labelTreeRef:d(),labelTreeDivRef:d(),setPasswordRef:d(),recycleBinRef:d(),backupAndRecoveryRef:d(),fastLoginRef:d(),aiAddPasswordRef:d(),labelDrawer:d(),favoriteDrawer:d(),tourRef:d(),showPasswordRef:d(),exportExcelRef:d(),importExcelRef:d(),contextmenuRef:d(),createPasswordBtnRef:d(),aiCreatePasswordBtnRef:d(),passwordFormFormRef:d(),passwordFormTitleRef:d(),passwordFormGenerateBtnRef:d(),passwordFormGenerateRuleRef:d(),passwordFormSaveBtnRef:d(),displayModeCardRef:d(),displayModeTableRef:d(),searchInputRef:d(),noteTitleRef:d()})});class Dt{fileNames={store:"store.json",setting:"setting.json",note:"note.json"};fileEtags={};serverUrl="";token="";async login(e){return console.log("登录私有服务"),this.serverUrl=e.serverUrl,new Promise(t=>{V.post(this.serverUrl+"/login",{username:e.username,password:e.password}).then(o=>{if(console.log("私有服务登录结果：",o),o.status!==200){t({status:!1,message:o.statusText});return}if(o.data.code!==200){t({status:!1,message:o.data.message});return}this.token=o.data.data,t({status:!0})}).catch(o=>{console.log("私有服务登录失败",o),t({status:!1,message:this.errorDispose(o.message)})})})}async getStoreData(){return this.getFile(this.fileNames.store)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){return new Promise((o,r)=>{const a=new FormData;a.append("file",e),V.post(this.serverUrl+"/uploadImage/"+t,a,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.token}`}}).then(n=>{console.log("上传成功",n.data),o(this.serverUrl+"/image"+n.data.data.objectKey)}).catch(n=>{console.error("上传失败",n),r(n)})})}async getFile(e){return console.log("获取private文件：",e),new Promise((t,o)=>{V.post(this.serverUrl+"/get",{key:e},{headers:{Authorization:`Bearer ${this.token}`}}).then(r=>{if(r.data.code===500){console.log("private 获取文件错误：",r.data),T.error({title:"系统异常",message:this.errorDispose(r.data.message)}),o({status:!1,message:r.data.message});return}if(r.data.code===404){console.log("private 获取文件404"),t("");return}if(r.status===200){this.updateEtag(e,r.data.data.etag),t(r.data.data.content);return}o({status:!1,message:r.statusText})}).catch(r=>{T.error({title:"系统异常",message:r.message}),o({status:!1,message:r})})})}async uploadFile(e,t){return console.log("上传private文件：",e),new Promise(async(o,r)=>{if(!await this.checkEtag(e)){console.log("上传private文件 文件同步异常"),Ke({title:"文件同步异常",message:"当前密码列表已被其他客户端更新，请刷新页面",showCancelButton:!1,showConfirmButton:!0,closeOnPressEscape:!1,showClose:!1,closeOnClickModal:!1,confirmButtonText:"刷新",callback:()=>{console.log("刷新"),location.reload()}});return}V.post(this.serverUrl+"/put",{key:e,content:t},{headers:{Authorization:`Bearer ${this.token}`}}).then(n=>{if(n.data.code===500){console.log("private 上传文件错误：",n.data),T.error({title:"系统异常",message:this.errorDispose(n.data.message)}),r({status:!1,message:n.data.message});return}if(n.status===200){this.updateEtag(e,n.data.data.etag),o({status:!0});return}r({status:!1,message:n.statusText})}).catch(n=>{T.error({title:"系统异常",message:n.message}),r({status:!1,message:n})})})}async deleteFile(e){return console.log("删除private文件：",e),new Promise((t,o)=>{V.post(this.serverUrl+"/delete",{key:e},{headers:{Authorization:`Bearer ${this.token}`}}).then(r=>{if(r.data.code===500){console.log("private 删除文件错误：",r.data),T.error({title:"系统异常",message:this.errorDispose(r.data.message)}),o({status:!1,message:r.data.message});return}if(r.status===200){t({status:!0});return}o({status:!1,message:r.statusText})}).catch(r=>{o({status:!1,message:r})})})}errorDispose(e){return console.log(e),e.indexOf("Invalid URL")!==-1?"无效的服务地址":{"IORuntimeException: IOException: Permission denied":"服务端文件权限不足","Network Error":"无法连接到服务器"}[e]||e}getEtag(e){return new Promise(async(t,o)=>{V.post(this.serverUrl+"/getEtag",{key:e},{headers:{Authorization:`Bearer ${this.token}`}}).then(r=>{if(r.data.code===500){console.log("private 获取文件标记错误：",r.data),T.error({title:"系统异常",message:this.errorDispose(r.data.message)}),o({status:!1,message:r.data.message});return}if(r.status===200){t(r.data.data.etag);return}o({status:!1,message:r.statusText})}).catch(r=>{T.error({title:"系统异常",message:r.message}),o({status:!1,message:r})})})}async checkEtag(e){if(!this.fileEtags[e])return Promise.resolve(!0);let t=await this.getEtag(e);return this.fileEtags[e]===t}async updateEtag(e,t){console.log("private updateEtag:",t),this.fileEtags[e]=t}}class bt{fileNames={store:"store.json",setting:"setting.json",note:"password-xl/note.json"};async login(e){return console.log("使用electron存储"),Promise.resolve({status:!0})}async getStoreData(){return this.getFile(this.fileNames.store)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){return new Promise(async o=>{const r=await e.arrayBuffer();let a=await window.electronAPI.uploadImage(e.name,r,t);o(a)})}async getFile(e){return console.log("获取electron文件",e),new Promise(async t=>{let o=await window.electronAPI.getFile(e);t(o||"")})}async uploadFile(e,t){return console.log("上传electron文件",e),new Promise(async o=>{window.electronAPI.uploadFile(e,t),o({status:!0})})}async deleteFile(e){return console.log("删除electron文件",e),new Promise(t=>{window.electronAPI.deleteFile(e),t({status:!0})})}}class Ct{fileNames={store:"store.json",setting:"setting.json",note:"note.json"};async login(e){return console.log("使用android存储"),Promise.resolve({status:!0})}async getStoreData(){return this.getFile(this.fileNames.store)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){throw new Error("安卓本地存储暂不支持上传图片，请改用其他存储方式")}async getFile(e){return console.log("获取android文件",e),new Promise(async t=>{let o=await window.androidAPI.getFile(e);t(o||"")})}async uploadFile(e,t){return console.log("上传android文件",e),new Promise(async o=>{window.androidAPI.uploadFile(e,t),o({status:!0})})}async deleteFile(e){return console.log("删除android文件",e),new Promise(t=>{window.androidAPI.deleteFile(e),t({status:!0})})}}const ae=Z("loginStore",{state:()=>({loginType:"",logging:!1,loggingText:"正在登录...",loginForm:null}),actions:{startLogin:async function(s,e){return console.log("开始自动登录"),new Promise(async t=>{let o=null;if(s.loginType==="oss"){const i=await se(()=>import("./DatabaseForOSS-DxJ0Ey6E.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url);o=new i.DatabaseForOSS}else if(s.loginType==="cos")o=new St;else if(s.loginType==="private")o=new Dt;else if(s.loginType==="electron")o=new bt;else if(s.loginType==="android")o=new Ct;else{console.error("未知的登录类型，无法自动登录：",s.loginType),t(!1);return}this.loginType=s.loginType,console.log("自动登录中...");let r=L();r.loading("自动登录中...");let a=await o.login(s);if(!a.status){console.log("自动登录失败 存储引擎登录失败",a),r.unloading(),t(!1);return}let n=await r.passwordManager.login(o).catch(()=>t(!1));if(!n||!n.status){console.log("自动登录初始化失败",n),r.unloading(),t(!1);return}if(r.serviceStatus===y.LOGGED){let i=r.passwordManager.unlock(e);console.log("自动登录 解锁结果：",i),r.unloading(),t(i)}else r.serviceStatus===y.WAIT_INIT&&(r.unloading(),t(!0));this.loginForm=s})},autoLogin(){return new Promise(async s=>{try{let e=localStorage.getItem("loginInfo");if(!e){console.log("自动登录loginInfo不存在"),s(!1);return}let t=N(H(),e);if(!t){console.log("自动登录loginInfo解密失败"),s(!1);return}let o=JSON.parse(t),r=await this.getMainPassword(o);console.log("使用主密码解密登录信息");let a=JSON.parse(N(r,o.loginForm)),n=await this.startLogin(a,r);console.log("本地缓存自动登录结果",n),s(n)}catch(e){console.log(e),s(!1)}})},async getMainPassword(s){let e=localStorage.getItem("mainPassword");if(e){console.log("自动登录获取主密码 使用自动解锁的主密码");let t=N(H(),e);if(Ce(t,s.loginForm))return t}return console.log("自动登录获取主密码 提示用户输入主密码"),await q().verifyPasswordRef.getAndVerify(t=>Ce(t,s.loginForm),s.mainPasswordType)},setAutoLoginInfo(s){const e=K();let t=sessionStorage.getItem("loginForm");if(e.setting.autoLogin&&t){let o=N(H(),t);console.log("使用浏览器指纹解密登录信息loginForm");let r={mainPasswordType:L().mainPasswordType,loginForm:A(s,o)};console.log("使用主密码加密登录信息loginInfo"),localStorage.setItem("loginInfo",A(H(),JSON.stringify(r))),sessionStorage.removeItem("loginForm")}if(e.setting.autoUnlock){let o=H();localStorage.setItem("mainPassword",A(o,s))}},updateRememberLoginInfo(s,e){console.log("修改密码，处理自动登录信息");try{let t=localStorage.getItem("loginInfo");if(!t)return console.log("修改记住的密码ciphertext不存在"),!1;let o=H();console.log("解密登录西悉尼");let r=N(o,t);if(!r)return console.log("修改记住的密码ciphertext解密失败"),!1;let a=JSON.parse(r),n=L().mainPasswordType;return console.log("修改密码，设置主密码类型：",n),a.mainPasswordType=n,a.loginForm=A(e,N(s,a.loginForm)),console.log("修改密码，存储登录信息"),localStorage.setItem("loginInfo",A(o,JSON.stringify(a))),!0}catch(t){return console.error("修改密码处理自动登录信息异常",t),!1}}}}),Pt=Z("noteStore",{state:()=>({noteData:{noteTree:[],currentNote:""}}),actions:{getTreeNoteById(s,e=this.noteData.noteTree){for(const t of e){if(t.id===s)return t;if(t.children){const o=this.getTreeNoteById(s,t.children);if(o)return o}}return null}}});class Fe{storeData=null;treeNoteData=null;databaseClient=null;passwordStore=L();loginStore=ae();settingStore=K();noteStore=Pt();refStore=q();nodeCacheMap=new Map;async login(e){return console.log("passwordManager 登录"),new Promise(async(t,o)=>{try{const[r,a,n]=await Promise.all([e.getStoreData(),e.getSettingData(),e.getTreeNoteData()]);r&&(this.storeData=JSON.parse(r),this.storeData&&this.storeData.mainPasswordType&&(this.passwordStore.mainPasswordType=this.storeData.mainPasswordType)),a&&(console.log("passwordManager 验证通过初始化设置信息"),Object.assign(this.settingStore.setting,JSON.parse(a))),n&&(console.log("passwordManager 验证通过初始化笔记信息"),this.treeNoteData=JSON.parse(n)),console.log("passwordManager 设置存储引擎"),this.databaseClient=e,this.passwordStore.passwordManager=this,console.log("passwordManager 密码管理器初始化成功"),this.storeData&&this.storeData.passwordData?(this.passwordStore.mainPasswordType=this.storeData.mainPasswordType,this.passwordStore.setServiceStatus(y.LOGGED)):this.passwordStore.setServiceStatus(y.WAIT_INIT),t({status:!0})}catch(r){o({status:!1,message:r})}})}async initMainPassword(e,t){if(console.log("passwordManager 初始化主密码"),this.serviceStatusAssert(y.WAIT_INIT),this.passwordStore.mainPassword)throw new Error("密码已存在，不允许初始化");if(!this.databaseClient)throw new Error("系统异常");console.log("passwordManager 初始化主密码开始");try{this.passwordStore.mainPassword=t,this.storeData={passwordData:A(t,JSON.stringify(be([]))),labelData:A(t,JSON.stringify([])),mainPasswordType:e};let o=await this.databaseClient.setStoreData(JSON.stringify(this.storeData));return!o||!o.status?Promise.reject(o):await this.syncSetting()?(console.log("passwordManager 同步设置成功"),this.passwordStore.mainPasswordType=e,console.log("passwordManager login 设置服务状态为已解锁"),this.passwordStore.setServiceStatus(y.UNLOCKED),console.log("passwordManager 主密码初始化成功"),this.addDemoData(),await this.syncStoreData(),Me(()=>{this.refStore.tourRef?.startTour()}),Promise.resolve({status:!0})):(console.log("passwordManager 同步设置异常"),Promise.reject({status:!1,message:"设置同步失败"}))}catch(o){return Promise.reject(o)}}addDemoData(){console.log("passwordManager 添加演示密码");let e={id:Date.now(),pid:0,name:"网站",children:[]},t={id:Date.now(),title:"百度（示例数据）",address:"https://www.baidu.com",username:"18395708888",password:ze(this.settingStore.setting.generateRule),remark:"百度网盘、百度贴吧",addTime:Date.now(),updateTime:Date.now(),deleteTime:0,favoriteTime:0,favorite:!0,customFields:[],labels:[e.id],status:B.NORMAL,bgColor:""};this.passwordStore.labelArray.push(e),this.passwordStore.allPasswordArray.push(t)}verifyPassword(e,t){try{return t?!!N(e,t):this.storeData?!!N(e,this.storeData.passwordData):!1}catch{return!1}}async updateMainPassword(e,t,o){if(!this.databaseClient)return Promise.reject();if(console.log("passwordManager 修改主密码"),this.serviceStatusAssert(y.UNLOCKED),!this.verifyPassword(e))return console.log("passwordManager 原密码验证失败，不允许修改"),Promise.reject({status:!1,message:"旧密码错误"});console.log("passwordManager 原密码验证通过"),this.passwordStore.loading("密码修改中...");let a=JSON.stringify(this.storeData),n=JSON.stringify(this.treeNoteData);this.storeData={passwordData:A(o,JSON.stringify(be(this.passwordStore.allPasswordArray))),labelData:A(o,JSON.stringify(this.passwordStore.labelArray)),mainPasswordType:t},this.treeNoteData={noteData:A(o,JSON.stringify(this.noteStore.noteData)),mainPasswordType:t};let i=await this.databaseClient.setStoreData(JSON.stringify(this.storeData)),l=await this.databaseClient.setNoteData(JSON.stringify(this.treeNoteData));return!i||!i.status||!l||!l.status?(this.storeData=JSON.parse(a),this.treeNoteData=JSON.parse(n),T.error({title:"系统异常",message:i.message}),Promise.reject()):(this.passwordStore.mainPasswordType=t,this.passwordStore.mainPassword=o,this.loginStore.updateRememberLoginInfo(e,o),console.log("passwordManager 主密码修改成功"),this.passwordStore.unloading(),Promise.resolve({status:!0}))}addPassword(e){console.log("passwordManager 新增密码：",e),this.serviceStatusAssert(y.UNLOCKED);const t={...e,id:Date.now(),addTime:Date.now(),updateTime:Date.now(),status:B.NORMAL};return this.passwordStore.allPasswordArray.unshift(t),this.syncStoreData()}updatePassword(e){console.log("passwordManager 修改密码：",e.id),this.serviceStatusAssert(y.UNLOCKED);const t=this.passwordStore.allPasswordArray.findIndex(o=>o.id===e.id);return t!==-1?(this.passwordStore.allPasswordArray[t]=e,this.syncStoreData()):Promise.reject("没有找到这个密码："+e.id)}deletePassword(e){if(console.log("passwordManager 删除密码：",e),this.serviceStatusAssert(y.UNLOCKED),this.settingStore.setting.enableRecycleBin){const o=this.passwordStore.allPasswordArray.findIndex(r=>r.id===e);if(o!==-1){if(this.passwordStore.allPasswordArray[o].status===B.DELETED)return this.completelyDeletePassword(e);{let a=this.passwordStore.allPasswordArray[o];return a.deleteTime=Date.now(),a.status=B.DELETED,this.syncStoreData()}}else throw new Error("密码不存在")}else return this.completelyDeletePassword(e)}completelyDeletePassword(e){console.log("passwordManager 彻底删除密码：",e),this.serviceStatusAssert(y.UNLOCKED);const t=this.passwordStore.allPasswordArray.findIndex(o=>o.id===e);if(t!==-1)return this.passwordStore.allPasswordArray.splice(t,1),this.syncStoreData();throw new Error("未找到指定ID的密码")}cancelDeletePassword(e){console.log("passwordManager 取消删除密码：",e),this.serviceStatusAssert(y.UNLOCKED);const t=this.passwordStore.allPasswordArray.findIndex(o=>o.id===e);if(t!==-1){let o=this.passwordStore.allPasswordArray[t];return o.deleteTime=0,o.status=B.NORMAL,this.syncStoreData()}else throw new Error("未找到指定ID的密码")}unlock(e){if(console.log("passwordManager 准备解锁密码本"),this.serviceStatusAssert(y.LOGGED),!this.storeData)throw new Error("系统异常");try{if(!Ce(e,this.storeData.passwordData))return G.error("解锁失败-密码错误"),!1;let t=N(e,this.storeData.passwordData),o=N(e,this.storeData.labelData);if(!t||!o)return G.error("解锁失败-密码错误"),!1;if(this.treeNoteData&&this.treeNoteData.noteData){let r=N(e,this.treeNoteData.noteData);r&&(this.noteStore.noteData=JSON.parse(r))}return this.passwordStore.allPasswordArray=wt(JSON.parse(t)),this.passwordStore.labelArray=JSON.parse(o),this.passwordStore.mainPassword=e,this.passwordStore.setServiceStatus(y.UNLOCKED),console.log("密码本已解锁"),this.loginStore.setAutoLoginInfo(e),!0}catch(t){return console.log("密码本解锁失败"),console.error(t),!1}}lock(){console.log("passwordManager 锁定密码"),this.passwordStore.mainPassword="",this.passwordStore.allPasswordArray=[],this.passwordStore.labelArray=[],this.passwordStore.setServiceStatus(y.LOGGED),localStorage.removeItem("mainPassword")}emptyRecycle(){return console.log("passwordManager 清空回收站"),this.passwordStore.allPasswordArray=this.passwordStore.allPasswordArray.filter(e=>e.status!==B.DELETED),this.syncStoreData()}syncSetting(){if([y.NO_LOGIN].includes(this.passwordStore.serviceStatus))throw new Error("当前状态不允许该操作："+this.passwordStore.serviceStatus);if(!this.databaseClient)throw new Error("系统异常databaseClient isnull syncLabelData");return this.databaseClient.setSettingData(JSON.stringify(this.settingStore.setting))}syncStoreData(){if(this.serviceStatusAssert(y.UNLOCKED),this.storeData={passwordData:A(this.passwordStore.mainPassword,JSON.stringify(be(this.passwordStore.allPasswordArray))),labelData:A(this.passwordStore.mainPassword,JSON.stringify(this.passwordStore.labelArray)),mainPasswordType:this.passwordStore.mainPasswordType},!this.databaseClient)throw new Error("系统异常databaseClient isnull syncLabelData");return this.databaseClient.setStoreData(JSON.stringify(this.storeData))}syncNoteData(){if(this.serviceStatusAssert(y.UNLOCKED),!this.databaseClient)throw new Error("系统异常databaseClient isnull syncNoteData");console.log("同步笔记数据",this.noteStore.noteData);let e={noteData:A(this.passwordStore.mainPassword,JSON.stringify(this.noteStore.noteData)),mainPasswordType:this.passwordStore.mainPasswordType};return this.databaseClient.setNoteData(JSON.stringify(e))}getStoreData(){if(this.storeData)return this.storeData;throw new Error("文件不存在")}getTreeNoteData(){if(this.treeNoteData)return this.treeNoteData;throw new Error("文件不存在")}async closeAccount(){return console.log("passwordManager 注销账号"),new Promise(async e=>{if(this.serviceStatusAssert(y.UNLOCKED),!this.databaseClient)throw new Error("系统异常databaseClient isnull closeAccount");let t=await this.databaseClient.deleteStoreData().catch(o=>o);await this.databaseClient.deleteSettingData().catch(o=>o),e(t)})}serviceStatusAssert=e=>{if(this.passwordStore.serviceStatus!==e)throw new Error("当前服务状态不允许该操作："+this.passwordStore.serviceStatus)};getData=e=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull getData");let t=this.nodeCacheMap.get(e);return t?Promise.resolve(t):new Promise(o=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull getData");this.databaseClient.getData(e).then(r=>{this.nodeCacheMap.set(e,r),o(r)})})};setData=(e,t)=>new Promise(o=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull setData");this.databaseClient.setData(e,t).then(r=>{this.nodeCacheMap.set(e,t),o(r)})});delData=e=>new Promise(t=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull setData");this.databaseClient.deleteData(e).then(o=>{t(o)})});uploadImage=(e,t)=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull setData");return this.databaseClient.uploadImage(e,t)}}const L=Z("passwordStore",{state:()=>({passwordManager:new Fe,allPasswordArray:[],labelArray:[],mainPassword:"",serviceStatus:y.NO_LOGIN,topicMode:R.AUTO,mainPasswordType:j.GESTURE,timeoutLock:null,globalLoading:{vis:!1,timeout:null,content:""},filterCondition:{searchText:"",labelArray:[],favoriteId:0}}),getters:{passwordArray(){console.log("获取排序后的密码列表");const s=K();let e=this.allPasswordArray.filter(t=>t.status===B.NORMAL).sort((t,o)=>{let r=t[s.setting.sortField],a=o[s.setting.sortField];return s.setting.sortField==="strength"&&(r=ne(t.password),a=ne(o.password)),r>a?s.setting.sortOrder===re.ASC?1:-1:r<a?s.setting.sortOrder===re.ASC?-1:1:0});return console.log("排序后的密码列表数量：",e.length),e},deletedArray(){console.log("获取已删除的密码列表");let s=this.allPasswordArray.filter(e=>e.status===B.DELETED).sort((e,t)=>e.deleteTime>t.deleteTime?1:e.deleteTime<t.deleteTime?-1:0);return console.log("已删除的密码列表数量：",s.length),s},favoritePasswordArray(){console.log("获取收藏的密码列表");let s=this.passwordArray.filter(e=>e.favorite).sort((e,t)=>e.favoriteTime>t.favoriteTime?1:e.favoriteTime<t.favoriteTime?-1:0);return console.log("收藏的密码列表数量：",s.length),s},visPasswordArray(){console.log("获取显示的密码列表");let s=this.passwordArray.filter(e=>{if(this.filterCondition.favoriteId)return e.id===this.filterCondition.favoriteId;let t=!0,o=!0;if(this.filterCondition.searchText){t=!1;const r=[e.title,e.address,e.username,e.password,e.remark].filter(Boolean);if(e.customFields)for(let a=0;a<e.customFields.length;a++)r.push(e.customFields[a].key),r.push(e.customFields[a].val);for(const a of r)if(Et(this.filterCondition.searchText.trim(),a)){t=!0;break}}if(this.filterCondition.labelArray.length){o=!1;const r=new Set(e.labels);for(const a of this.filterCondition.labelArray)if(r.has(a)){o=!0;break}}return t&&o});return console.log("显示的密码列表数量：",s.length),s},isDark(){return this.topicMode===R.DARK}},actions:{setServiceStatus(s){console.log("服务状态变更为：",s),this.serviceStatus=s},logout(){console.log("退出登录"),sessionStorage.removeItem("loginForm"),localStorage.removeItem("loginInfo"),localStorage.removeItem("mainPassword"),localStorage.removeItem("topicMode"),this.passwordManager=new Fe,this.allPasswordArray=[],this.labelArray=[],this.mainPassword="",this.serviceStatus=y.NO_LOGIN,L().$resetFields(),ae().$resetFields(),K().$resetFields(),location.href=Ne()+"#/login"},setTopicMode(s){if(console.log("设置主题:",s),localStorage.setItem("topicMode",s),s===R.AUTO){let e=window.matchMedia("(prefers-color-scheme: dark)");Se().value=e.matches,this.topicMode=e.matches?R.DARK:R.LIGHT,window.electronAPI?.setTopic("system"),window.androidAPI?.setTopic("system")}else s===R.DARK?(Se().value=!0,this.topicMode=R.DARK,window.electronAPI?.setTopic(this.topicMode),window.androidAPI?.setTopic(this.topicMode)):s===R.LIGHT&&(Se().value=!1,this.topicMode=R.LIGHT,window.electronAPI?.setTopic(this.topicMode),window.androidAPI?.setTopic(this.topicMode))},loading(s){console.log("触发全局加载"),this.globalLoading.timeout=setTimeout(()=>{this.globalLoading.timeout=null,this.globalLoading.vis=!0,this.globalLoading.content=s||"请稍等"},300)},unloading(){console.log("取消全局加载"),this.globalLoading.timeout&&(clearTimeout(this.globalLoading.timeout),this.globalLoading.timeout=null),this.globalLoading.vis=!1},resetTimeoutLock(){this.timeoutLock&&(clearTimeout(this.timeoutLock),this.timeoutLock=null);const s=K();s.setting.timeoutLock!==0&&(this.timeoutLock=setTimeout(()=>{if(s.setting.timeoutLock&&this.serviceStatus===y.UNLOCKED&&!s.setting.autoUnlock){console.log("超时自动锁定"),this.passwordManager.lock();let e=q();e.settingRef?.closeSetting(),e.passwordFormRef?.closePasswordForm()}},s.setting.timeoutLock*1e3))}}}),cs=s=>s&&/^.*:\/\/.*$/.test(s),W=d(""),ie=()=>{let s=window.innerWidth;return s<768?W.value="xs":s>=768&&s<992?W.value="sm":s>=992&&s<1200?W.value="md":s>=1200&&s<1920?W.value="lg":W.value="xl",W};window.onresize=()=>{ie()};async function At(s,e=!1){let t=document.createElement("textarea");t.setAttribute("readonly","readonly"),t.value=s,document.body.appendChild(t),t.setSelectionRange(0,t.value.length),t.select(),document.execCommand("copy"),document.body.removeChild(t),e||G.success("复制成功"),console.log("复制到剪切板成功")}const Et=(s,e)=>{if(!e||!s)return!1;try{const t=s.toLowerCase();if(e.toLowerCase().includes(t))return!0}catch(t){console.log(t)}return!1},ne=s=>{if(!s)return 0;let e=0;return/[0-9]/.test(s)&&e++,/[a-z]/.test(s)&&e++,/[A-Z]/.test(s)&&e++,/[^0-9a-zA-Z_]/.test(s)&&e++,s.length<6&&e>2&&(e=2),e>3?3:e},te={uppercase:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",lowercase:"abcdefghijklmnopqrstuvwxyz",number:"0123456789",symbol:"~!@#$%^&*()_-+=.,;"};function ze(s){let e=[s.uppercase?te.uppercase:"",s.lowercase?te.lowercase:"",s.number?te.number:"",s.symbol?te.symbol:""].filter(Boolean);const t=K();if(t.setting.easyConfuseChat){const r=t.setting.easyConfuseChat.split("");for(let a=0;a<e.length;a++)for(let n=0;n<r.length;n++)e[a]=e[a].replace(r[n],"")}if(e=e.filter(Boolean),!e.length)return T.error({title:"生成失败",message:"请检查易混淆字符配置"}),"";let o="";for(let r=0;r<s.length;r++){const a=e[r%e.length],n=Math.floor(Math.random()*a.length);o+=a[n]}return o.split("").sort(()=>Math.random()-.5).join("")}const us=(s,e)=>{if(!s.labels)return[];const t=(r,a)=>{for(let n=0;n<r.length;n++)s.labels.includes(r[n].id)&&a.push(r[n]),r[n].children.length&&t(r[n].children,a)},o=[];return t(e||L().labelArray,o),o},ds=s=>{let e=s.title+`\r
`;if(s.address&&(e+="地址: "+s.address+`\r
`),s.username&&(e+="用户名: "+s.username+`\r
`),s.password&&(e+="密码: "+s.password+`\r
`),s.customFields)for(let t=0;t<s.customFields.length;t++){let o=s.customFields[t];e+=o.key+": "+o.val+`\r
`}s.remark&&(e+=s.remark+`\r
`),e=e.substring(0,e.length-2),At(e,!0),G.success("已复制到剪切板")},gs=s=>{let e=ne(s);return["","#F56C6C","#FF9700","#67C23A"][e]},fs=s=>{let e=ne(s);return["","弱密码","中等强度密码","强密码"][e]},Tt=(s,e)=>{const t=new Date(s),o=f=>f<10?"0"+f:f,r=t.getFullYear(),a=o(t.getMonth()+1),n=o(t.getDate()),i=o(t.getHours()),l=o(t.getMinutes()),c=o(t.getSeconds());return e.replace("YYYY",r.toString()).replace("MM",a.toString()).replace("DD",n.toString()).replace("HH",i.toString()).replace("mm",l.toString()).replace("ss",c.toString())},hs=(s,e)=>{const t=e.split(/[^A-Za-z]/),o=s.split(/[^0-9]/),r={};t.forEach((w,h)=>{r[w]=parseInt(o[h],10)});const a=r.YYYY||1970,n=(r.MM||1)-1,i=r.DD||1,l=r.HH||0,c=r.mm||0,f=r.ss||0;return new Date(a,n,i,l,c,f)},ps=(s,e)=>{let t=Date.now();e.forEach(o=>{let r=s.findIndex(n=>n.id===o.id);if(r===-1){s.push(o);return}let a=s[r];if(Nt(o,a)){if(o.labels&&o.labels.length>0){const n=new Set(a.labels);a.labels=o.labels.filter(i=>!n.has(i))}return}o.remark+="（合并恢复 "+Tt(Date.now(),"YYYY-MM-DD HH:mm")+"）",o.id=t++,s.push(o)})},ms=(s,e)=>{let t=Date.now();const o=(n,i)=>{for(const l of n){if(l.id===i)return!0;if(l.children&&l.children.length>0)return o(l.children,i)}return!1},r=(n,i)=>{for(const l of n)if(l.id===i.id&&l.name===i.name&&l.pid===i.pid)return l},a=(n,i)=>{const l=r(n,i);if(!l)o(s,i.id)&&(i.id=t++),n.push(i);else for(const c of i.children)a(l.children,c)};for(const n of e)a(s,n)},ws=()=>{let s=0;const e=t=>{t.forEach(o=>{s++,o.children&&o.children.length>0&&e(o.children)})};return e(L().labelArray),s},ys=s=>{let e="";const t=(o,r)=>{o.forEach(a=>{s.includes(a.id)&&(e&&(e+="、"),e+=r+"->"+a.name),a.children&&a.children.length>0&&t(a.children,a.name)})};return t(L().labelArray,""),e},vs=s=>{const e=s.split("、"),t=[];return e.forEach(o=>{const r=o.split("->").map(n=>n.trim());let a;r.forEach((n,i)=>{let l;i===0?(l=t.find(c=>c.name===n&&c.pid===0),!l&&n&&(l={id:Re(),name:n,pid:0,children:[]},t.push(l))):(l=a?.children.find(c=>c.name===n),l||(l={id:Re(),name:n,pid:a?a.id:0,children:[]},a?.children.push(l))),a=l})}),t},xt=(s,e,t,o,r)=>Math.sqrt((o-s)*(o-s)+(r-e)*(r-e))<=t,Oe=s=>s.title+s.username+s.address+s.password+s.remark,Nt=(s,e)=>Oe(s)===Oe(e),Ne=()=>{let s=location.origin;return s.startsWith("file://")&&(s+=location.pathname),s},Ss=(s,e)=>{if(!s)return"";let t=s.replace("rgb","rgba");return t=t.replace(")",","+e+")"),t};let _t=Date.now();const Re=()=>_t++,Lt=s=>Ne()+"/#/login?type="+s.loginType+"&autoLogin="+A("password-xl",JSON.stringify(s)),kt=()=>S.lib.WordArray.random(8).toString(S.enc.Hex),Pe={apiServer:"https://ai.password-xl.cn",publicKey:`-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvoEZ2yxmxt4mp8ipUmlI
4re+2MLfKcNacXeFOQWh8C3TxumN7I2CLieBX5zRTUfJJalsWlvUjsrXB8NXGjpJ
jqCQWGz+qC4N4UcAwW1olZOM2OBHD+eDtu/GlyBUp9Arf5BblXZcURbMWmh4V821
P7u2ChzxtR/EO107fZGgOcsS7o0LDa9f+Jy7uwhxCJlwoOyC5bCjCZIiayqGRkXx
x75c/i9OcRhovP+oE0eDkwsjBaP5nqUDufxLXUOD0RVOnchlpxS+9Fc58F5nZ4bx
FgAs4rSkgfZ4yc2DyvASc1iu9grjxpLA3ZDmH3L7PLv/ifyFeELlojd2VFzSl0qJ
PwIDAQAB
-----END PUBLIC KEY-----
`},It=async s=>{let e=ze({length:16,number:!0,lowercase:!0,uppercase:!0,symbol:!1});return new Promise(async(t,o)=>{let r=await mt(Pe.publicKey,e),a=JSON.stringify({text:s}),n=A(e,a),i={encryptKey:r,data:n};V.post(Pe.apiServer+"/extractPassword",i).then(l=>{let c=l.data;if(c.code!==200){o(c.message);return}let f=N(e,c.data);t(f)}).catch(l=>{console.log("提取密码失败",l),o("提取密码失败")})})},Ft={"element-loading-text":"正在处理..."},Ot={style:{"margin-top":"10px"}},Rt=Y({__name:"AiAddPassword",setup(s,{expose:e}){const t=q(),o=d({vis:!1,loading:!1,text:""}),r=()=>{o.value.text="",o.value.loading=!1,o.value.vis=!0},a=()=>{o.value.loading=!0,It(o.value.text).then(n=>{t.passwordFormRef.addPasswordForm(),t.passwordFormRef.setPasswordForm(JSON.parse(n)),o.value.vis=!1,o.value.loading=!1,o.value.text=""}).catch(n=>{o.value.loading=!1,T.error({title:"系统异常",message:n})})};return e({show:r}),(n,i)=>{const l=Ae,c=Ee,f=Te,w=xe,h=Je;return x(),X(w,{modelValue:g(o).vis,"onUpdate:modelValue":i[1]||(i[1]=p=>g(o).vis=p),width:["xs","sm"].includes(g(ie)().value)?"95%":"550px",title:"AI创建密码"},{footer:D(()=>[b(f,{disabled:!g(o).text||g(o).loading,plain:"",type:"primary",onClick:a},{default:D(()=>[...i[4]||(i[4]=[O(" Ai解析 ",-1)])]),_:1},8,["disabled"])]),default:D(()=>[Be((x(),U("div",Ft,[b(l,{type:"info"},{default:D(()=>[...i[2]||(i[2]=[O(" 你可以直接粘贴包含账号密码信息的字符串，Ai大模型将自动解析您的密码 ",-1)])]),_:1}),F("div",Ot,[b(c,{modelValue:g(o).text,"onUpdate:modelValue":i[0]||(i[0]=p=>g(o).text=p),rows:6,placeholder:"请粘贴账号密码到这里",type:"textarea"},null,8,["modelValue"])]),b(l,{size:"small",type:"danger"},{default:D(()=>[...i[3]||(i[3]=[O(" 您的密码信息将在加密后传输至Ai大模型进行处理，密码信息不会以任何形式进行存储 ",-1)])]),_:1})])),[[h,g(o).loading]])]),_:1},8,["modelValue","width"])}}}),Mt={style:{"margin-top":"5px"}},Bt={style:{"margin-top":"10px"}},Ut={style:{"margin-top":"5px"}},Gt=Y({__name:"FastLogin",setup(s,{expose:e}){const t=Ve(),o=d(""),r=d(!1),a=l=>{if(console.log("快速登录提示"),location.href.indexOf("autoLogin")!==-1||window.electronAPI||window.androidAPI){t.push("/");return}o.value=Lt(l),r.value=!0},n=l=>JSON.parse(N("password-xl",l)),i=()=>{r.value=!1,t.push("/")};return e({fastLoginTip:a,getFastLoginForm:n}),(l,c)=>{const f=Ae,w=Ee,h=Te,p=xe;return x(),X(p,{modelValue:g(r),"onUpdate:modelValue":c[0]||(c[0]=E=>Ue(r)?r.value=E:null),"append-to-body":!0,fullscreen:["xs","sm"].includes(g(ie)().value),width:"700px"},{header:D(()=>[b(f,{size:"large",style:{"user-select":"none"}},{default:D(()=>[...c[1]||(c[1]=[F("span",{class:"iconfont icon-verify"},null,-1),O(" 登录成功 ",-1)])]),_:1})]),footer:D(()=>[b(h,{type:"primary",onClick:i},{default:D(()=>[...c[4]||(c[4]=[O("好的",-1)])]),_:1})]),default:D(()=>[F("div",null,[b(f,{type:"info"},{default:D(()=>[...c[2]||(c[2]=[O("以下链接可以自动输入登录信息，您可以保存此链接以防丢失：",-1)])]),_:1})]),F("div",Mt,[b(w,{"model-value":g(o),rows:7,type:"textarea"},null,8,["model-value"])]),F("div",Bt,[b(f,{type:"info"},{default:D(()=>[...c[3]||(c[3]=[O("该链接为password-XL首页地址，您可以收藏：",-1)])]),_:1})]),F("div",Ut,[b(w,{"model-value":g(Ne)(),readonly:""},null,8,["model-value"])])]),_:1},8,["modelValue","fullscreen"])}}}),$e=(s,e)=>{const t=s.__vccOpts||s;for(const[o,r]of e)t[o]=r;return t},Kt=$e(Gt,[["__scopeId","data-v-f7fd9401"]]),Jt=Y({__name:"GesturePassword",props:{ciphertext:{type:String},showGesture:{type:Boolean,default:!0}},emits:["complete","pass","fail"],setup(s,{emit:e}){const t=L(),o=e;let r=s;const a=oe([]),n=oe([]),i=d(),l=d();let c;const f=d(!1),w=d(""),h=d(null),p={pointCellSize:3,cellPointRadio:.33,gesturePointColor:"#cacaca",circleCenterRadio:.25,gesturePointCenterColor:"#409EFF",gesturePointCenterErrorColor:"#F56C6C",lineWidth:12,lineColor:"rgba(64,158,255,0.32)",lineErrorColor:"rgba(245,108,108,0.32)"},E=u=>{M()},k=u=>{M()},_=()=>{let u=n.map(v=>v.id).join();le(u),M()},le=u=>{if(!r.ciphertext){if(n.length=0,u.length<5){console.log("设置密码，手势主密码 请至少连接3个点"),G.warning("请至少连接3个点");return}o("complete",De(u));return}w.value=t.passwordManager.verifyPassword(u,r.ciphertext)?"pass":"fail",M(),w.value?o("pass",De(u)):o("fail",De(u)),setTimeout(()=>{w.value="",n.length=0,M()},500)},M=()=>{!i.value||!l.value||(ce(),ue(),ge(),r.showGesture&&(P(),de(),Q()))},Q=()=>{if(!c)return;let u=[...n];if(h.value&&f.value&&!w.value&&u.push(h.value),!(u.length<2))for(let v=1;v<u.length;v++){let C=u[v-1],I=u[v];c.beginPath(),c.strokeStyle=w.value==="fail"?p.lineErrorColor:p.lineColor,c.lineWidth=p.lineWidth,c.moveTo(C.x,C.y),c.lineTo(I.x,I.y),c.stroke()}},ce=()=>{if(!f.value||w.value==="fail")return;let u=m();if(!u)return;n.find(C=>C.id===u.id)||n.push(u)},ue=()=>{!c||!l.value||c.clearRect(0,0,l.value.width,l.value.height)},de=()=>{if(!(!i.value||!l.value||!c))for(let u=0;u<n.length;u++){let v=n[u];$(v)}},P=()=>{if(!i.value||!l.value||!c||w.value||!h.value)return;let u=m();u&&$(u)},m=()=>{if(!i.value||!l.value||!c||!h.value)return null;for(let u=0;u<a.length;u++){let v=a[u];if(xt(v.x,v.y,v.radius,h.value.x,h.value?.y))return v}return null},$=u=>{c&&(c.beginPath(),c.fillStyle=w.value?p.gesturePointCenterErrorColor:p.gesturePointCenterColor,c.arc(u.x,u.y,u.radius*p.circleCenterRadio,0,Math.PI*2),c.fill(),c.beginPath(),c.fillStyle=w.value?p.lineErrorColor:p.lineColor,c.arc(u.x,u.y,u.radius*p.circleCenterRadio*2,0,Math.PI*2),c.fill(),c.beginPath(),c.strokeStyle=w.value?p.gesturePointCenterErrorColor:p.gesturePointCenterColor,c.lineWidth=2,c.arc(u.x,u.y,u.radius,0,Math.PI*2),c.stroke())},ge=()=>{c&&a.forEach(u=>{c&&(c.beginPath(),c.strokeStyle=p.gesturePointColor,c.lineWidth=2,c.arc(u.x,u.y,u.radius,0,Math.PI*2),c.stroke(),c.beginPath(),c.fillStyle=p.gesturePointColor,c.arc(u.x,u.y,u.radius*p.circleCenterRadio,0,Math.PI*2),c.fill())})},fe=u=>{f.value=!0;let v={x:u.offsetX,y:u.offsetY};h.value=v,E()},he=u=>{let v={x:u.offsetX,y:u.offsetY};h.value=v,k()},pe=()=>{f.value&&(f.value=!1,h.value=null,_())},me=()=>{f.value&&(f.value=!1,h.value=null,_())},we=u=>{if(!l.value)return;f.value=!0;let v=l.value.getBoundingClientRect(),C={x:u.touches[0].clientX-v.x,y:u.touches[0].clientY-v.y};h.value=C,E()},ye=u=>{if(!l.value)return;let v=l.value.getBoundingClientRect(),C={x:u.touches[0].clientX-v.x,y:u.touches[0].clientY-v.y};h.value=C,k()},J=()=>{f.value&&(f.value=!1,h.value=null,_())};function Xe(u,v,C){const I=window.devicePixelRatio||1;u.width=v*I,u.height=C*I,u.style.width=`${v}px`,u.style.height=`${C}px`;const ee=u.getContext("2d");return ee.scale(I,I),ee}const Le=()=>{if(!i.value||!l.value)return;let u=i.value.clientWidth;console.log("画板大小：",u),l.value.width=u,l.value.height=u,c=Xe(l.value,u,u);let v=0;a.length=0;for(let C=0;C<p.pointCellSize;C++)for(let I=0;I<p.pointCellSize;I++){let ee=C*u/p.pointCellSize,Ye=I*u/p.pointCellSize,ke=u/p.pointCellSize,Ze=u/p.pointCellSize,qe={id:v++,x:ee+ke/2,y:Ye+Ze/2,radius:ke*p.cellPointRadio};a.push(qe)}M()};let ve=null;return window.onresize=()=>{ve&&clearTimeout(ve),ve=setTimeout(Le,100)},Qe(()=>{Me(()=>{Le()})}),(u,v)=>(x(),U("div",{ref_key:"gestureDivRef",ref:i,style:{width:"100%",height:"100%"}},[F("canvas",{ref_key:"canvasRef",ref:l,style:{"image-rendering":"auto"},onMousedown:fe,onMouseleave:me,onMousemove:he,onMouseup:pe,onTouchend:J,onTouchmove:ye,onTouchstart:we},null,544)],512))}}),Vt={key:0,style:{margin:"20px"}},jt={key:1,style:{margin:"20px"}},zt={style:{display:"flex","justify-content":"space-between"}},$t=Y({__name:"VerifyMainPassword",setup(s,{expose:e}){const t=Ve(),o=L(),r=K(),a=d(),n=d(),i=d(!1),l=d(null),c=d(""),f=d(JSON.parse(JSON.stringify(o.mainPasswordType))),w=d(),h=oe({mainPassword:""}),p=oe({mainPassword:[{required:!0,message:"请输入主密码",trigger:"change"}]}),E=(P,m)=>(console.log("获取并验证主密码 passwordType:",m),f.value=m||o.mainPasswordType,c.value="getAndVerify",w.value=P,m===j.STANDARD&&n.value?.resetFields(),h.mainPassword="",i.value=!0,new Promise($=>l.value=$)),k=()=>(console.log("验证密码并解锁"),f.value=o.mainPasswordType,c.value="verifyAndUnlock",o.mainPasswordType===j.STANDARD&&n.value?.resetFields(),h.mainPassword="",i.value=!0,new Promise(async P=>l.value=P)),_=P=>{console.log("标准密码输入确认"),P.validate(m=>{if(!m){a.value.focus(),console.log("主密码必填校验未通过");return}c.value==="getAndVerify"?M():c.value==="verifyAndUnlock"&&Q()})},le=P=>{console.log("手势密码绘制完成"),h.mainPassword=P,c.value==="getAndVerify"?M():c.value==="verifyAndUnlock"&&Q()},M=()=>{if(console.log("获取并验证主密码回调 验证方法是否存在：",!!w.value),!w.value){i.value=!1,l.value&&l.value(h.mainPassword);return}try{if(!w.value(h.mainPassword)){console.log("验证失败"),G.error("验证失败");return}}catch(P){console.error("验证失败",P),G.error("验证失败");return}i.value=!1,l.value&&l.value(h.mainPassword)},Q=()=>{if(console.log("验证并解锁回调方法"),!o.passwordManager.verifyPassword(h.mainPassword)){console.log("验证失败"),G.error("验证失败");return}if(!o.passwordManager.unlock(h.mainPassword)){console.log("验证失败"),G.error("验证失败");return}i.value=!1,l.value&&l.value(h.mainPassword)},ce=()=>{console.log("跳转登录页"),i.value=!1,t.push("/login")},ue=()=>{f.value===j.STANDARD&&a.value?.focus()},de=()=>o.serviceStatus===y.NO_LOGIN&&localStorage.getItem("showGesture")==="false"?!1:r.setting.verifyShowGesture;return e({getAndVerify:E,verifyAndUnlock:k}),(P,m)=>{const $=Ae,ge=Ee,fe=nt,he=at,pe=Jt,me=it,we=Te,ye=xe;return x(),X(ye,{modelValue:g(i),"onUpdate:modelValue":m[4]||(m[4]=J=>Ue(i)?i.value=J:null),"close-on-click-modal":g(o).serviceStatus!==g(y).NO_LOGIN,"close-on-press-escape":g(o).serviceStatus!==g(y).NO_LOGIN,"show-close":g(o).serviceStatus!==g(y).NO_LOGIN,width:["xs","sm"].includes(g(ie)().value)?"95%":"400px",top:"20vh",onOpen:m[5]||(m[5]=J=>g(n)?.resetFields()),onOpened:ue},{header:D(()=>[b($,{size:"large",style:{"user-select":"none"}},{default:D(()=>[m[8]||(m[8]=F("span",{class:"iconfont icon-verify"},null,-1)),g(o).serviceStatus===g(y).NO_LOGIN?(x(),U(Ge,{key:0},[m[6]||(m[6]=O("自动登录",-1)),m[7]||(m[7]=F("span",{style:{"font-weight":"bold"}}," · ",-1))],64)):z("",!0),m[9]||(m[9]=O(" 验证主密码 ",-1))]),_:1})]),footer:D(()=>[F("div",zt,[F("div",null,[g(o).serviceStatus===g(y).NO_LOGIN?(x(),X(me,{key:0,underline:!1,type:"primary",onClick:ce},{default:D(()=>[...m[10]||(m[10]=[O("返回登录页 ",-1)])]),_:1})):z("",!0)]),g(f)===g(j).STANDARD?(x(),X(we,{key:0,type:"primary",onClick:m[3]||(m[3]=J=>_(g(n)))},{default:D(()=>[...m[11]||(m[11]=[O(" 确定 ",-1)])]),_:1})):z("",!0)])]),default:D(()=>[g(f)===g(j).STANDARD?(x(),U("div",Vt,[b(he,{ref_key:"formRef",ref:n,model:g(h),rules:g(p),onSubmit:m[2]||(m[2]=et(()=>{},["prevent"]))},{default:D(()=>[b(fe,{prop:"mainPassword"},{default:D(()=>[b(ge,{ref_key:"passwordInputRef",ref:a,modelValue:g(h).mainPassword,"onUpdate:modelValue":m[0]||(m[0]=J=>g(h).mainPassword=J),autocomplete:"new-password",placeholder:"请输入主密码","show-password":"",type:"password",onKeyup:m[1]||(m[1]=tt(J=>_(g(n)),["enter","native"]))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])):z("",!0),g(f)===g(j).GESTURE?(x(),U("div",jt,[b(pe,{"show-gesture":de(),onComplete:le},null,8,["show-gesture"])])):z("",!0)]),_:1},8,["modelValue","close-on-click-modal","close-on-press-escape","show-close","width"])}}}),Ht=$e($t,[["__scopeId","data-v-26ea6b62"]]),Wt="data:image/svg+xml,%3csvg%20version='1.1'%20baseProfile='full'%20width='100%25'%20height='100%25'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201400%20800'%20%3e%3crect%20x='1300'%20y='400'%20rx='40'%20ry='40'%20width='300'%20height='300'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='0%201450%20550'%20to='360%201450%20550'%20repeatCount='indefinite'/%3e%3c/rect%3e%3cpath%20d='M%20100%20350%20A%20150%20150%200%201%201%20400%20350%20Q400%20370%20380%20370%20L%20250%20370%20L%20120%20370%20Q100%20370%20100%20350'%20stroke='rgb(253,%20214,%2099)'%20fill='rgb(253,%20214,%2099)'%3e%3canimateMotion%20path='M%20800%20-200%20L%20800%20-300%20L%20800%20-200'%20dur='20s'%20begin='0s'%20repeatCount='indefinite'/%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20values='0%20210%20530%20;%20-30%20210%20530%20;%200%20210%20530'%20keyTimes='0%20;%200.5%20;%201'%20repeatCount='indefinite'/%3e%3c/path%3e%3ccircle%20cx='200'%20cy='150'%20r='20'%20stroke='%231a73e8'%20fill='%231a73e8'%3e%3canimateMotion%20path='M%200%200%20L%2040%2020%20Z'%20dur='5s'%20repeatCount='indefinite'/%3e%3c/circle%3e%3c!--%20三角形%20--%3e%3cpath%20d='M%20165%20580%20L%20270%20580%20Q275%20578%20270%20570%20L%20223%20483%20Q220%20480%20217%20483%20L%20165%20570%20Q160%20578%20165%20580'%20stroke='rgb(238,%20103,%2092)'%20fill='rgb(238,%20103,%2092)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='0%20210%20530'%20to='360%20210%20530'%20repeatCount='indefinite'/%3e%3c/path%3e%3ccircle%20cx='1200'%20cy='600'%20r='30'%20stroke='rgb(241,%20243,%20244)'%20fill='rgb(241,%20243,%20244)'%3e%3canimateMotion%20path='M%200%200%20L%20-20%2040%20Z'%20dur='9s'%20repeatCount='indefinite'/%3e%3c/circle%3e%3cpath%20d='M%20100%20350%20A%2040%2040%200%201%201%20180%20350%20L%20180%20430%20A%2040%2040%200%201%201%20100%20430%20Z'%20stroke='rgb(241,%20243,%20244)'%20fill='rgb(241,%20243,%20244)'%3e%3canimateMotion%20path='M%20140%20390%20L%20180%20360%20L%20140%20390'%20dur='20s'%20begin='0s'%20repeatCount='indefinite'/%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20values='0%20140%20390;%20-60%20140%20390;%200%20140%20390'%20keyTimes='0%20;%200.5%20;%201'%20repeatCount='indefinite'/%3e%3c/path%3e%3crect%20x='900'%20y='600'%20rx='30'%20ry='30'%20width='90'%20height='90'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='50s'%20type='rotate'%20from='0%20900%20550'%20to='360%20900%20550'%20repeatCount='indefinite'/%3e%3c/rect%3e%3c/svg%3e",Xt="data:image/svg+xml,%3csvg%20version='1.1'%20baseProfile='full'%20width='100%25'%20height='100%25'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20800%201400'%20%3e%3c!--%20绿色大方块--%3e%3crect%20x='700'%20y='1000'%20rx='40'%20ry='40'%20width='300'%20height='300'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%20style='transform-box:fill-box;%20transform-origin:center;'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='0%200%200'%20to='360%200%200'%20repeatCount='indefinite'/%3e%3c/rect%3e%3c!--%20白色椭圆--%3e%3cpath%20d='M%20100%20350%20A%2040%2040%200%201%201%20180%20350%20L%20180%20430%20A%2040%2040%200%201%201%20100%20430%20Z'%20stroke='rgb(241,%20243,%20244)'%20fill='rgb(241,%20243,%20244)'%3e%3canimateMotion%20path='M%20240%20590%20L%20180%20360%20L%20240%20590'%20dur='20s'%20begin='0s'%20repeatCount='indefinite'/%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20values='0%20140%20390;%20-60%20140%20390;%200%20140%20390'%20keyTimes='0%20;%200.5%20;%201'%20repeatCount='indefinite'/%3e%3c/path%3e%3c!--%20绿色小方块--%3e%3crect%20x='400'%20y='600'%20rx='40'%20ry='40'%20width='100'%20height='100'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='-30%20550%20750'%20to='330%20550%20750'%20repeatCount='indefinite'/%3e%3c/rect%3e%3csvg%20viewBox='0%200%201024%201024'%20version='1.1'%20x='100'%20y='1100'%20xmlns='http://www.w3.org/2000/svg'%20width='200px'%20height='200px'%3e%3cpath%20d='M225.28%20163.84h573.44c45.056%200%2081.92%2036.864%2081.92%2081.92v450.56c0%2045.056-36.864%2081.92-81.92%2081.92H225.28c-45.056%200-81.92-36.864-81.92-81.92V245.76c0-45.056%2036.864-81.92%2081.92-81.92z%20m430.08%20450.56c79.872%200%20143.36-63.488%20143.36-143.36s-63.488-143.36-143.36-143.36-143.36%2063.488-143.36%20143.36%2063.488%20143.36%20143.36%20143.36z%20m0-81.92c34.816%200%2061.44-26.624%2061.44-61.44s-26.624-61.44-61.44-61.44-61.44%2026.624-61.44%2061.44%2026.624%2061.44%2061.44%2061.44z'%20fill='%230af1f4'%20style='transform-box:fill-box;%20transform-origin:center;'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20from='0%200%200'%20to='360%200%200'%20repeatCount='indefinite'/%3e%3c/path%3e%3c/svg%3e%3c/svg%3e",Yt={key:0,alt:"",class:"back-img hidden-xs-only",src:Wt},Zt={key:1,alt:"",class:"back-img hidden-sm-and-up",src:Xt},qt=["element-loading-text"],Qt=Y({__name:"App",setup(s){const e=q(),t=K(),o=L();let r=localStorage.getItem("topicMode")||"auto";o.setTopicMode(r),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{let l=localStorage.getItem("topicMode")||"auto";console.log("系统主题变动，设置主题为：",l),o.setTopicMode(l)});const n=d(!1);return(()=>{let l=localStorage.getItem("dynamicBackground");(!l||l==="true")&&(n.value=!0)})(),st(()=>t.setting.dynamicBackground,l=>{localStorage.setItem("dynamicBackground",l.toString()),n.value=t.setting.dynamicBackground}),(l,c)=>{const f=ot("router-view"),w=Ht,h=Kt,p=Rt,E=ct,k=Je;return x(),U(Ge,null,[g(n)?(x(),U("img",Yt)):z("",!0),g(n)?(x(),U("img",Zt)):z("",!0),Be((x(),U("div",{id:"password-app","element-loading-text":g(o).globalLoading.content,onClick:c[0]||(c[0]=_=>g(o).resetTimeoutLock())},[b(E,{locale:g(lt)},{default:D(()=>[b(f),b(w,{ref:_=>g(e).verifyPasswordRef=_},null,512),b(h,{ref:_=>g(e).fastLoginRef=_},null,512),b(p,{ref:_=>g(e).aiAddPasswordRef=_},null,512)]),_:1},8,["locale"])],8,qt)),[[k,g(o).globalLoading.vis]])],64)}}}),es=[{path:"/",name:"Index",component:()=>se(()=>import("./IndexPage-CVXll8PL.js"),__vite__mapDeps([8,3,4,2,1,5,6,9,10,7,11]),import.meta.url)},{path:"/login",name:"Login",component:()=>se(()=>import("./LoginPage-BlTwbWdu.js").then(s=>s.L),__vite__mapDeps([12,4,3,2,1,5,6,9,13]),import.meta.url)},{path:"/note",name:"Note",component:()=>se(()=>import("./NotePage-DbpVI-7O.js"),__vite__mapDeps([14,4,3,2,1,5,6,10,15,16,7,17]),import.meta.url)}],ts=[y.LOGGED,y.WAIT_INIT,y.UNLOCKED],He=ut({history:dt(),routes:es});He.beforeEach((s,e,t)=>{if(console.log("路由变化：",e.path,s.path),s.path==="/login"||s.path==="/test"){ae().logging=!1,t();return}let o=L();const r=K();if(ts.includes(o.serviceStatus)){t();return}if(!r.setting.autoLogin||s.path.startsWith("/login")){t("/login");return}try{console.log("router 尝试自动登录"),ae().autoLogin().then(a=>{console.log("router 自动登录结果:",a),a?t():(console.log("autoLoginFail"),t("/login"))})}catch(a){console.error("router 自动登录异常",a),t("/login")}});const ss=({options:s,store:e})=>{e.$resetFields=t=>{const{state:o}=s;let r=o?o():{};e.$patch(a=>{t&&(r=gt(r,t)),Object.assign(a,r)})}},We=ft();We.use(ss);let _e=rt(Qt);_e.use(He);_e.use(We);_e.mount("#app");V.get(Pe.apiServer+"/getVersion",{withCredentials:!0}).then(s=>{console.log("v"+s.data.data)}).catch(s=>{console.error("获取版本失败",s)});export{ne as A,se as B,St as C,Dt as D,bt as E,Ct as F,Pt as G,kt as H,He as I,ys as J,vs as K,hs as L,j as M,Re as N,Nt as O,je as P,y as S,R as T,$e as _,q as a,K as b,At as c,ie as d,ae as e,re as f,Lt as g,A as h,H as i,Jt as j,Tt as k,ws as l,Ce as m,N as n,wt as o,ps as p,ms as q,B as r,ze as s,Ss as t,L as u,cs as v,us as w,ds as x,fs as y,gs as z};
